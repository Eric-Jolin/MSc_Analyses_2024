---
title: "Chapter 10 Habitat use"
output:
  word_document: default
  html_document: default
date: "2023-08-02"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

The following script was modifed from the CBeirne CT data analysis workshop, chapter 10 habitat use.

#Mixed-effects Models

Camera traps are well suited for the quantification of habitat use across multiple species. To assess habitat use, we typically quantify the detection rate - the number of detections divided by the time interval of interest. As detection rates are fairly simple to estimate and conceptually simple to understand, thus their use is widespread in the camera trap literature.

In its simplest form habitat use represents the number of independent events of a given species at a given camera, divided by the number of days that camera was active during that period of interest.

This ‘detection rate’ is thought to reflect the habitat use of a species at a given location. Extreme care should be taken if you want to equate use with abundance or density - something we discuss a little more in the density chapter.

Detection rates are typically analysed in a linear modelling framework, and come in single species and multi-species versions (see below).

# Load the required packages

```{r}
# Check you have them and load them
list.of.packages <- c("kableExtra", "tidyr", "ggplot2", "gridExtra", "dplyr", "Hmsc", "jtools", "lubridate", "corrplot", "MuMIn","stringr","sf","raster","leaflet", "tidyverse","htmlwidgets","webshot", "purrr", "magick","forcats","multcomp", "reshape2")

new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
lapply(list.of.packages, require, character.only = TRUE)
```


#  Prepare Data

```{r}
locs <- read.csv("Processed_Data/TDN_camera_locations_and_covariates_cleaned.csv", header=T)

# Convert to categorical factors
locs <- locs %>% 
            mutate_if(is.character,as.factor)

# You should also standardize your covariates - it helps models coverage and facillitates comparison of effects sizes

#NEED TO RUN THIS SO LAT/LONG DONT GET STANDARDIZED
library(MuMIn)
z_locs <- stdize(locs, omit.cols = c("latitude","longitude","latitude_site","longitude_site"))
```

#######################################################################################################################################################################################################################################################################################################################################

# Caribou Seasons

Rather than defining seasons in a community aspect using snowcover (which would be more suited to a multispecies analysis) I want to divide data by biologically relevant "caribou seasons". The problem here is that these seasons vary by date from year to year and from herd to herd based on GPS collar data. I have 2021-2022 dates for the Ahiak herd from GN reports but I don't have similar recent seasonal date ranges for the Bathurst/Beverly herds (date ranges used in many reports for the Bathurst herd are from a 2011 study). Do have telemetry data for the Bev/Bath caribou but it's clipped to the spatial extent of TDN. 

Determine first obs, last obs, and number of days observed in TDN for each individual collared caribou using 2021/2022 collar data. Extracted attribute table as csv from shapefile using arcgis

```{r}
#read in collar data
TDN_Bev_Bath_GPS<-read.csv("Raw_Data/TDN_Bev_Bath_Telemetry.csv")

# Convert LoctnDt to Date format
TDN_Bev_Bath_GPS$LoctnDt <- as.Date(TDN_Bev_Bath_GPS$LoctnDt)
```

Summarize the collar data
```{r}
# Group by AnimalId, Sex, and Herd, then summarize to find first date, last date, count of observations, and number of unique dates
caribou_indv_summary <- TDN_Bev_Bath_GPS %>%
  group_by(AnimlId, SEX, Herd) %>%
  summarize(
    FirstDate = min(LoctnDt),
    LastDate = max(LoctnDt),
    NumObservations = n(),
    NumUniqueDates = n_distinct(LoctnDt)
  )

# Group by Herd, Sex, and then summarize to find first date, last date, count of observations, number of individuals, and number of unique dates
herd_summary <- TDN_Bev_Bath_GPS %>%
  group_by(Herd, SEX) %>%
  summarize(
    FirstDate = min(LoctnDt),
    LastDate = max(LoctnDt),
    NumObservations = n(),
    NumIndividuals = n_distinct(AnimlId),
    NumUniqueDates = n_distinct(LoctnDt)
  )

print(herd_summary)

# If you want separate summaries for each Herd irrespective of sex
herd_summary_no_sex <- TDN_Bev_Bath_GPS %>%
  group_by(Herd) %>%
  summarize(
    FirstDate = min(LoctnDt),
    LastDate = max(LoctnDt),
    NumObservations = n(),
    NumIndividuals = n_distinct(AnimlId),
    NumUniqueDates = n_distinct(LoctnDt)
  )
```
Herd       SEX    FirstDate  LastDate   NumObservations NumIndividuals NumUniqueDates
  <chr>      <chr>  <date>     <date>               <int>          <int>          <int>
1 Bathurst   Female 2021-10-27 2021-11-15              45              2             18
2 Bathurst   Male   2021-10-29 2022-05-06             186              3             41
3 Beverly    Female 2021-10-27 2022-01-17             707             16             83
4 Beverly    Male   2021-10-29 2022-08-30            1049             12            215
5 Unassigned Female 2021-11-18 2021-11-21               7              1              3

Looks like the cows are only using TDN during Rut/Breeding, Fall Migration - post-breeding, and the start of Winter according to seasonal cutoff dates other Bathurst papers have used.

Ahiak have slightly different seasonal cutoff dates but collared cows roughly use TDN in 2021/2022 in Late Summer, Fall migration - pre-breeding, Rut/breeding, Fall migration - post-breeding, Winter, no spring migration, then back for Summer and Late Summer. 

If we used these dates, how do we account for the different herds (Ahiak winters here but they're expected to winter on the tundra as opposed to Bev/Bath) and the seasons where we're less likely to have female caribou (i.e. spring)

#######################################################################################################################################################################################################################################################################################################################################

```{r}
 library(lme4); library(tidyr) #load GLMM specific packages

#oo <- options(repos = "https://cran.r-project.org/")
#install.packages("Matrix")
#install.packages("lme4")
#options(oo)
```

The lme4 package requires a dataframe format (as above), with the response term and the predictor variables all included in the same location.

Next we will fit a mixed effects model to this data set using lme4. You may have noticed that we haven’t calculated a separate capture rate dataframe! That is because we can create a relative abundance index within the model itself by providing an offset() term . An offset term serves to scale the response term based on the amount of survey effort, and preserves the original units of the observations (counts).

The model takes the form:

Response term ~ fixed effect + offset() + (1|random intercept), data frame, distribution

We include location_site as the random intercept, as camera locations are clustered are not independent. We use the poisson family, as our response term is a count.

Convergence errors often arise as when we fit a model which is too complicated! It basically says the the model hasn’t completely “solved” the parameters within it.

#NOTE: 2024-02-25 ######################################################################
removed monthly data as realistically too coarse to be used to infer anything useful.

# Multiseason, DAILY

The telemetry data was informative but still found it difficult to set seasonal cutoff dates based on that alone. Plotting daily detection rate for caribou might be a better way to find natural seasonal breaks and is the most detailed data we have on hand. 

Let's see how this breaks down into 1 day events to help determine seasonal breaks
```{r}
#Load biweekly detection data
daily_obs<-read.csv("Processed_Data/wildRtrax/TDN_cam_summaries_day_mam.csv")
```

Join this dataframe with the location data, as before:
```{r}
mod_dat_daily <- left_join(daily_obs, z_locs)
```

And let’s do another raw data check:
```{r}
boxplot(mod_dat_daily$Caribou~mod_dat_daily$dom_habitat_lcc_hexagon,
        las=2,
        xlab="lcc landcover",
        ylab="Habitat use")
```

Add snow based seasons
```{r}
#format day as Date
mod_dat_daily$day<-as.Date(mod_dat_daily$day)

#create column season
mod_dat_daily <- mod_dat_daily %>%
  mutate(snow_season = ifelse(month(day) %in% c(5, 6, 7, 8, 9, 10), "summer", "winter"))

# Get the column names
column_names <- names(mod_dat_daily)

# Reorder the columns
new_column_order <- c(column_names[1:4], "snow_season", column_names[5:length(column_names)])

# Create the reordered data frame
mod_dat_daily <- mod_dat_daily[, new_column_order]

# make it a factor factors
mod_dat_daily <- mod_dat_daily %>% 
            mutate_if(is.character,as.factor)

```

let's plot caribou detections summed across locations per biweek coloured by snow based seasons
```{r}
# Group by day and summarize the total Caribou count and effort
daily_sum <- mod_dat_daily %>%
  group_by(year = year(day), day, snow_season) %>%
  summarise(total_caribou = sum(Caribou), total_effort = sum(n_days_effort))

# Plot the data for total Caribou count
ggplot(daily_sum, aes(x = day, y = total_caribou, fill = snow_season)) +
  geom_bar(stat = "identity", position = "dodge", color = "black") +
  labs(title = "Total Caribou Count Summed Across Locations by Day",
       x = "Day",
       y = "Total Caribou Count") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 8))+
  scale_x_date(date_breaks = "1 month", date_labels = "%b %Y")


# Plot the data for capture rate
daily_sum$total_daily_cr <- (daily_sum$total_caribou / daily_sum$total_effort)

ggplot(daily_sum, aes(x = day, y = total_daily_cr, fill = snow_season)) +
  geom_bar(stat = "identity", position = "dodge", color = "black") +
  labs(title = "Total Caribou Daily CR Across Locations by Day",
       x = "Day",
       y = "Total Caribou CR") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 8)) +
  scale_x_date(date_breaks = "1 month", date_labels = "%b %Y")
```
Based on the daily detections it looks like caribou detection rate could be broken down into the following biologically relevant seasons. These dates roughly conform to date ranges for the Beverly, Bathurst, and AHiak herds listed in various GN and GNWT reports. 

Typical caribou seasons (Nagy 2011 and GN use 9 seasons):
July 29, 2021 - Oct 20, 2021: Summer/Late Summer
Oct 21, 2021 - Oct 31, 2021: Pre-breeding Migration
Nov 1, 2021 - Dec 14, 2021: Rut/Post-breeding Migration
Dec 15, 2021 - Apr 4, 2022: Winter
Apr 5, 2022 - May 14, 2022: Spring Migration
May 15, 2022 - early June, 2022: Calving
early June, 2022 - July 30, 2022: Post-calving/Summer
July 31, 2022 - Aug 24, 2022: Late Summer

Simplified 4 seasons (Bathurst Range Plan also uses 4):
July 29, 2021 - Oct 20, 2021: Summer
Oct 21, 2021 - Dec 14, 2021: Fall
Dec 15, 2021 - Apr 4, 2022: Winter
Apr 5, 2022 - June 21, 2022: Spring
June 22, 2022 - Aug 24, 2022: Summer

Add simplified 4 seasons and plot
```{r}
# Define function to assign seasons based on date
assign_season <- function(date) {
  case_when(
    date >= as.Date("2021-07-29") & date <= as.Date("2021-10-20") ~ "Summer",
    date >= as.Date("2021-10-21") & date <= as.Date("2021-12-14") ~ "Fall",
    date >= as.Date("2021-12-15") & date <= as.Date("2022-04-04") ~ "Winter",
    date >= as.Date("2022-04-05") & date <= as.Date("2022-06-21") ~ "Spring",
    date >= as.Date("2022-06-22") & date <= as.Date("2022-08-24") ~ "Summer",
    TRUE ~ "Unknown" # Default case
  )
}

# Create new column "four_season"
mod_dat_daily <- mod_dat_daily %>%
  mutate(four_season = assign_season(day))

# Get the column names
column_names <- names(mod_dat_daily)

# Reorder the columns
new_column_order <- c(column_names[1:4], "snow_season", "four_season", column_names[5:length(column_names)])

# Create the reordered data frame
mod_dat_daily <- mod_dat_daily[, new_column_order]

# Make sure it's a factor
mod_dat_daily <- mod_dat_daily %>% 
            mutate_if(is.character,as.factor)

```

let's plot it out
```{r}
# Group by day and summarize the total Caribou count and effort
daily_sum <- mod_dat_daily %>%
  group_by(year = year(day), day, four_season) %>%
  summarise(total_caribou = sum(Caribou), total_effort = sum(n_days_effort))

# Plot the data for total Caribou count
ggplot(daily_sum, aes(x = day, y = total_caribou, fill = four_season)) +
  geom_bar(stat = "identity", position = "dodge", color = "black") +
  labs(title = "Total Caribou Count Summed Across Locations by Day",
       x = "Day",
       y = "Total Caribou Count") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 8)) +
  scale_x_date(date_breaks = "1 month", date_labels = "%b %Y")


# Plot the data for capture rate
daily_sum$total_daily_cr <- (daily_sum$total_caribou / daily_sum$total_effort)

ggplot(daily_sum, aes(x = day, y = total_daily_cr, fill = four_season)) +
  geom_bar(stat = "identity", position = "dodge", color = "black") +
  labs(title = "Total Caribou Daily CR Across Locations by Day",
       x = "Day",
       y = "Total Caribou CR") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 8)) +
  scale_x_date(date_breaks = "1 month", date_labels = "%b %Y")

```

Try to illustrate this in a doughnut plot 
```{r}
# Sample data (replace with your actual start and end dates)
season_data <- data.frame(
  Season = c("Summer", "Fall", "Winter", "Spring"),
  Start_Date = as.Date(c("2021-07-29", "2021-10-21", "2021-12-15", "2022-04-05")),
  End_Date = as.Date(c("2021-10-20", "2021-12-14", "2022-04-04", "2022-06-21"))
)

# Calculate the duration of each season
season_data$Duration <- season_data$End_Date - season_data$Start_Date

# Create the doughnut chart
ggplot(season_data, aes(x = "", y = Duration, fill = Season)) +
  geom_bar(width = 1, stat = "identity", color = "white") +
  coord_polar("y", start = 0) +
  theme_void() +
  theme(legend.position = "right") +
  geom_text(aes(label = Season), position = position_stack(vjust = 0.5)) +
  scale_fill_manual(values = c("orange", "brown", "blue", "green")) +  # Customizing colors
  labs(title = "Duration of Four Seasons")  # Add title

```


########################################################################################################################################################################################################################################################################################################################################################################

#  Multiseason, WEEKLY detections
```{r}
# Import the total observations dataset
weekly_obs <- read.csv("Processed_Data/wildRtrax/TDN_cam_summaries_week_mam.csv", header=T)
```

Join this dataframe with the location data, as before:
```{r}
mod_dat_wk <- left_join(weekly_obs, z_locs)

# Remove rows with year 2021 and weeks 30, 31, 32, or 33 due to low survey effort
mod_dat_wk <- mod_dat_wk %>%
  filter(!(year == 2021 & week %in% c(30, 31, 32, 33)))
```

Raw data check:
```{r}
boxplot(mod_dat_wk$Caribou~mod_dat_wk$dom_habitat_lcc_hexagon,
        las=2,
        xlab="lcc landcover",
        ylab="Habitat use")
```

create snow based seasons
```{r}
# Lets create a new column and give it the value summer
mod_dat_wk$snow_season <- "summer"
mod_dat_wk$snow_season[mod_dat_wk$week %in% c(44:53,1:17)] <- "winter"

# Get the column names
column_names <- names(mod_dat_wk)

# Reorder the columns
new_column_order <- c(column_names[1:3], "snow_season", column_names[4:length(column_names)])

# Create the reordered data frame
mod_dat_wk <- mod_dat_wk[, new_column_order]

# make it a factor factors
mod_dat_wk <- mod_dat_wk %>% 
            mutate_if(is.character,as.factor)

```

Plot caribou detections and rate summed across locations per week
```{r}
# Convert 'week' and 'year' to a Date object
mod_dat_wk$week_year <- as.Date(paste(mod_dat_wk$year, mod_dat_wk$week, "1", sep="-"), format="%Y-%U-%u")

# Group by week_year and summarize the total Caribou count and effort
weekly_sum <- mod_dat_wk %>%
  group_by(week_year, snow_season) %>%
  summarise(total_caribou = sum(Caribou),total_effort = sum(n_days_effort))

#create capture rate per 100 days
weekly_sum$total_weekly_cr<-((weekly_sum$total_caribou)/(weekly_sum$total_effort)*7)

# Plot the count data with color based on the 'season' column
ggplot(weekly_sum, aes(x = week_year, y = total_caribou, fill = snow_season)) +
  geom_bar(stat = "identity", position = "dodge", color = "black") +
  labs(title = "Total Caribou Count Summed Across Locations by Week",
       x = "Week of the Year",
       y = "Total Caribou Count") +
  theme_minimal() +
  scale_x_date(labels = scales::date_format("%Y-%m-%d"), date_breaks = "1 week") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, size=8))

#plot the Capture rate
ggplot(weekly_sum, aes(x = week_year, y = total_weekly_cr, fill = snow_season)) +
  geom_bar(stat = "identity", position = "dodge", color = "black") +
  labs(title = "Total Caribou Weekly CR Across Locations by Week",
       x = "Week of the Year",
       y = "Total Caribou CR") +
  theme_minimal() +
  scale_x_date(labels = scales::date_format("%Y.%m.%d"), date_breaks = "1 week") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, size=8)) 
```

let's repeat this process with the new 4-season caribou based dates from the daily detection data

Should the 4-seasons be based now on week instead of the daily detections even though it's less detailed?

based on daily detection rate:
July 29, 2021 - Oct 20, 2021: Summer
Oct 21, 2021 - Dec 14, 2021: Fall
Dec 15, 2021 - Apr 4, 2022: Winter
Apr 5, 2022 - June 21, 2022: Spring
June 22, 2022 - Aug 24, 2022: Summer

based on weekly detection rates? 
July 26, 2021 - Oct 18, 2021: Summer
Oct 25, 2021 - Dec 13, 2021: Fall
Dec 20, 2021 - Apr 4, 2022: Winter
Apr 11, 2022 - June 21, 2022: Spring
June 22, 2022 - Aug 24, 2022: Summer
```{r}
# Let's create a new column for the four seasons based on the specified date ranges
mod_dat_wk$four_season <- "Summer"
mod_dat_wk$four_season[mod_dat_wk$week_year >= as.Date("2021-07-29") & mod_dat_wk$week_year <= as.Date("2021-10-20")] <- "Summer"
mod_dat_wk$four_season[mod_dat_wk$week_year >= as.Date("2021-10-21") & mod_dat_wk$week_year <= as.Date("2021-12-14")] <- "Fall"
mod_dat_wk$four_season[mod_dat_wk$week_year >= as.Date("2021-12-15") & mod_dat_wk$week_year <= as.Date("2022-04-04")] <- "Winter"
mod_dat_wk$four_season[mod_dat_wk$week_year >= as.Date("2022-04-05") & mod_dat_wk$week_year <= as.Date("2022-06-21")] <- "Spring"
mod_dat_wk$four_season[mod_dat_wk$week_year >= as.Date("2022-06-22") & mod_dat_wk$week_year <= as.Date("2022-08-24")] <- "Summer"

# Get the column names
column_names <- names(mod_dat_wk)

# Reorder the columns
new_column_order <- c(column_names[1:3], "four_season", column_names[4:length(column_names)])

# Create the reordered data frame
mod_dat_wk <- mod_dat_wk[, new_column_order]

# Make it a factor
mod_dat_wk <- mod_dat_wk %>% 
            mutate_if(is.character, as.factor)


# Let's look at caribou detections summed across locations per week
# Group by week_year and summarize the total Caribou count and effort
weekly_sum <- mod_dat_wk %>%
  group_by(week_year, four_season) %>%
  summarise(total_caribou = sum(Caribou), total_effort = sum(n_days_effort))

# Create capture rate per 100 days
weekly_sum$total_weekly_cr <- (weekly_sum$total_caribou / weekly_sum$total_effort) * 7

# Plot the count data with color based on the 'four_season' column
ggplot(weekly_sum, aes(x = week_year, y = total_caribou, fill = four_season)) +
  geom_bar(stat = "identity", position = "dodge", color = "black") +
  labs(title = "Total Caribou Count Summed Across Locations by Week",
       x = "Week of the Year",
       y = "Total Caribou Count") +
  theme_minimal() +
  scale_x_date(labels = scales::date_format("%Y-%m-%d"), date_breaks = "1 week") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 8))

# Plot the capture rate
ggplot(weekly_sum, aes(x = week_year, y = total_weekly_cr, fill = four_season)) +
  geom_bar(stat = "identity", position = "dodge", color = "black") +
  labs(title = "Total Caribou Weekly CR Across Locations by Week",
       x = "Week of the Year",
       y = "Total Caribou CR") +
  theme_minimal() +
  scale_x_date(labels = scales::date_format("%Y-%m-%d"), date_breaks = "1 week") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 8)) 

```

map it out
```{r}
# Aggregate data by location and week to get total caribou detections
total_caribou_by_location_week <- mod_dat_wk %>%
  group_by(location, week) %>%
  summarise(total_caribou = sum(Caribou))

# Merge total caribou detections with latitude and longitude data
locations_week <- mod_dat_wk %>%
  distinct(location, latitude, longitude)

locations_week <- left_join(locations_week, total_caribou_by_location_week, by = "location") %>%
  mutate(has_detections = if_else(is.na(total_caribou) | total_caribou == 0, FALSE, TRUE))

# Create leaflet maps for each week
maps_folder <- "maps"
dir.create(maps_folder, showWarnings = FALSE)

for (week in unique(mod_dat_wk$week)) {
  map_data_week <- filter(locations_week, week == !!week)
  map <- leaflet(map_data_week) %>%
    addTiles() %>%
    addCircleMarkers(
      ~longitude, 
      ~latitude, 
      radius = ~if_else(has_detections, sqrt(total_caribou) * 2, 2), 
      color = ~if_else(has_detections, "blue", "grey"), 
      popup = ~paste("Location:", location, "<br>", "Total Caribou Detections:", total_caribou)
    )
  
  # Save the map as HTML
  map_file <- file.path(maps_folder, paste0("map_week_", week, ".html"))
  saveWidget(map, map_file, selfcontained = TRUE)
}

```

```{r}
# Function to read HTML files and convert them to images
#html_to_image <- function(html_file) {
#  webshot::webshot(html_file, file = tempfile(fileext = ".png"))
#}

# Read each HTML file, convert to images, and store them in a list
#map_images <- lapply(list.files("maps", pattern = "*.html", full.names = TRUE), html_to_image)

# Create the animated GIF
#gif_file <- "caribou_detections.gif"
#image_write(image_join(map_images), gif_file)

# Display the GIF
#browseURL(gif_file)
```

##Target Analysis
```{r}
# Reorder the levels of the target_cons column
mod_dat_wk$target_cons <- fct_relevel(mod_dat_wk$target_cons, "None")

#check the levels were reordered correctly. None should be first to act as the control feature. 
levels(mod_dat_wk$target_cons)

# Group by target_cons and count unique locations within each group
unique_locations_by_target <- mod_dat_wk %>%
  group_by(target_cons) %>%
  summarise(unique_locations = n_distinct(location))

# Print the result
print(unique_locations_by_target)

#run anova to determine whether targets are actually significantly related to our response variable (Caribou occurrences in a given week at a given camera)

region_wk_aov <- aov(Caribou ~ target_cons, data=mod_dat_wk)
summary(region_wk_aov)
```

Perform post-hoc tests if necessary to determine specific differences between groups.
```{r}
# Perform Tukey's HSD test
tukey_results <- TukeyHSD(region_wk_aov)

# View the results
print(tukey_results)
```

##Burn Analysis
try to run models with different burn variables to determine relative weights (i.e. importance) of burn variables to caribou occurrence. These weights can then be used to determine a composite burn variable which incorporates burn age, distance, and size. 

```{r}
# Fit GLMMs with different combinations of burn variables
model1 <- glmer.nb(Caribou ~ z.burn_distance_m + z.yrs_since_burn + z.burn_size_ha + offset(log(n_days_effort)) + (1 | location), data = mod_dat_wk)
model2 <- glmer.nb(Caribou ~ z.burn_distance_m + z.yrs_since_burn + offset(log(n_days_effort)) + (1 | location), data = mod_dat_wk)
model3 <- glmer.nb(Caribou ~ z.burn_distance_m + z.burn_size_ha + offset(log(n_days_effort)) + (1 | location), data = mod_dat_wk)
model4 <- glmer.nb(Caribou ~ z.yrs_since_burn + z.burn_size_ha + offset(log(n_days_effort)) + (1 | location), data = mod_dat_wk)
model5 <- glmer.nb(Caribou ~ z.burn_size_ha + offset(log(n_days_effort)) + (1 | location), data = mod_dat_wk)
model6 <- glmer.nb(Caribou ~ z.yrs_since_burn + offset(log(n_days_effort)) + (1 | location), data = mod_dat_wk)
model7 <- glmer.nb(Caribou ~ z.burn_distance_m + offset(log(n_days_effort)) + (1 | location), data = mod_dat_wk)

# Compare models using AIC or BIC
aic <- AIC(model1, model2, model3, model4, model5, model6, model7)
bic <- BIC(model1, model2, model3, model4, model5, model6, model7)

# Select the model with the lowest AIC or BIC value
best_model <- model1  # For example, if model1 has the lowest AIC or BIC

# Extract coefficients from the best model
coefficients <- fixef(best_model)

# Assign weights based on coefficients
weights <- coefficients / sum(coefficients)

# Create the composite burn variable
mod_dat_wk$z.composite_burn <- rowSums(mod_dat_wk[, c("z.burn_distance_m", "z.yrs_since_burn", "z.burn_size_ha")] * weights)

#run new model with composite burn value and compare with other models
model8<- glmer.nb(Caribou ~ z.composite_burn + offset(log(n_days_effort)) + (1 | location), data = mod_dat_wk)

# Compare models using AIC or BIC
aic <- AIC(model1, model2, model3, model4, model5, model6, model7, model8)
bic <- BIC(model1, model2, model3, model4, model5, model6, model7, model8)
```


###Simple Models
let's run a couple super simple models, one with a random effect and one with the survey effort offset and no extra covariates:
```{r}
# GLMM with only a random effect
glmm_wk_random <- glmer.nb(Caribou ~ 1 + (1 | location_site), data = mod_dat_wk)

summary(glmm_wk_random)

#GLMM with random and survey effort

glmm_wk_random_eff <- glmer.nb(Caribou ~ 1 +  offset(log(n_days_effort)) + (1 | location_site) , data = mod_dat_wk)

summary(glmm_wk_random_eff)
```


```{r}
#GLMM with random, survey effort, snow season
glmm_wk_snowssn <- glmer.nb(Caribou ~ 1 + snow_season + offset(log(n_days_effort)) + (1 | location_site) , data = mod_dat_wk)

summary(glmm_wk_snowssn)

#GLMM with random, survey effort, four season
glmm_wk_fourssn <- glmer.nb(Caribou ~ 1 + four_season + offset(log(n_days_effort)) + (1 | location_site) , data = mod_dat_wk)

summary(glmm_wk_fourssn)

#GLMM with random, survey effort, week.
glmm_wk_wk <- glmer.nb(Caribou ~ 1 + week + offset(log(n_days_effort)) + (1 | location_site) , data = mod_dat_wk)

summary(glmm_wk_wk)
```


### LCC

```{r}
glmm_wk_lcc <- glmer.nb(Caribou ~ 
                    z.X300_SPPGLM + z.X300_SPPSLM + z.X300_TSPNF + z.X300_SPTNF + z.X300_WET + z.X300_WAT + z.X300_MF + z.X300_TSPS + z.X300_BAR + z.X300_TSPBDF + four_season + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk)


summary(glmm_wk_lcc)
```


```{r}
effect_plot(glmm_wk_lcc, pred = z.X300_SPPGLM, interval = TRUE, y.label = "Habitat use",
            data=mod_dat_wk)
```

```{r}
effect_plot(glmm_wk_lcc, pred = four_season, interval = TRUE, y.label = "Habitat use",
            data=mod_dat_wk)
```

####Tundra LCC
```{r}
glmm_wk_lcc_tundra <- glmer.nb(Caribou ~ 
                    z.X300_SPPGLM + z.X300_SPPSLM + z.X300_WET + z.X300_WAT + z.X300_BAR + four_season + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk)


summary(glmm_wk_lcc_tundra)
```

####Treeline DIstance
```{r}
glmm_wk_treeline <- glmer.nb(Caribou ~ 
                    z.treeline_distance_m + four_season + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk)


summary(glmm_wk_treeline)
```


### DEM

Let's just look at our DEM covariates
```{r}
glmm_wk_dem <- glmer.nb(Caribou ~ 
                    z.mean_elev_300 + z.mean_tri_300 + z.esker_dist_m + four_season + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk)


summary(glmm_wk_dem)
```


### Target

```{r}
glmm_wk_tgt <- glmer.nb(Caribou ~ 
                     target_cons + four_season + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk)


summary(glmm_wk_tgt)
```


### Co-occurrences

#### Ungulates
```{r}
glmm_wk_ung <- glmer.nb(Caribou ~ 
                    Muskox + Moose + four_season + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk)


summary(glmm_wk_ung)
```


#### Predators
```{r}
glmm_wk_pred <- glmer.nb(Caribou ~ 
                    Gray.Wolf + Grizzly.Bear + Wolverine + four_season + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk)

summary(glmm_wk_pred)
```


### Significant Only

Let's cut it down to only the significant predictors from the previous models.
```{r}
glmm_wk_cat2 <- glmer.nb(Caribou ~ 
                    Gray.Wolf + z.X300_SPPGLM + z.X300_SPPSLM + z.X300_WET + z.X300_WAT + z.X300_MF + z.X300_BAR + z.mean_elev_300 + z.esker_dist_m + four_season + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk)


summary(glmm_wk_cat2)
```

Let's cut it down again....
```{r}
glmm_wk_cat3 <- glmer.nb(Caribou ~ 
                    Gray.Wolf + z.X300_SPPGLM + z.X300_SPPSLM + z.X300_WET + z.X300_WAT + z.X300_MF + z.X300_BAR + z.esker_dist_m + four_season + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk)

summary(glmm_wk_cat3)
```


target only model
```{r}
glmm_wk_tgtonly <- glmer.nb(Caribou ~ 
                     target_cons + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk)

summary(glmm_wk_tgtonly)
```

#############################################################################################

## DAG Models

Causal diagrams created using diggity to reduce bias and justify models based on hypothesized ecological processes. 

Can use R to import DAGs directly into this platform.
```{r}
#library(daggity)
```
Warning in install.packages :
  package ‘daggity’ is not available for this version of R


Hashtagged out these models because they aren't season specific and the DAG models change with seasons
####Bottom Up

```{r}
#glmm_wk_dag_bu<- glmer.nb(Caribou ~ 
                              #z.X300_SPPGLM + z.X300_SPPSLM + z.X300_BAR + z.X300_WET + z.X300_WAT + z.mean_elev_300 + z.mean_tri_300 + z.esker_dist_m + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk)

#summary(glmm_wk_dag_bu)
```

####Top Down
```{r}
#glmm_wk_dag_td<- glmer.nb(Caribou ~ 
                              #Gray.Wolf + Grizzly.Bear + z.X300_SPPGLM + z.X300_SPPSLM + z.X300_BAR  + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk)

#summary(glmm_wk_dag_td)
```

####Apparent Competition

Models the total effect of Muskox and Moose on caribou while adjusting for water, wetland, and DEM covariates. Griz and Wolf didn't require adjustment but this model implies that heterospecific ungulates are acting on caribou through predators.

```{r}
#glmm_wk_dag_appa<- glmer.nb(Caribou ~ 
#                              Muskox + Moose + z.X300_WET + z.X300_WAT + z.mean_elev_300 + z.mean_tri_300 + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk)

#summary(glmm_wk_dag_appa)
```

Compare with the model above. If wolf and griz have a strong effect here but ungulates don't have a strong effect above, the effect likely isn't due to apparent competition.
```{r}
#glmm_wk_dag_appb<- glmer.nb(Caribou ~ 
#                              Gray.Wolf + Grizzly.Bear + z.X300_SPPGLM + z.X300_SPPSLM + z.X300_BAR + z.X300_WET + z.X300_WAT + z.mean_elev_300 + z.mean_tri_300 +offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk)

#summary(glmm_wk_dag_appb)
```

#############################################################################################

## Committee Models

Uber simple models that the committee wants run on every data set and in every season

#### Bottom Up

wout target
```{r}
glmm_wk_comm_bu <- glmer.nb(Caribou ~ 
                  z.X300_SPPGLM + z.X300_SPPSLM + z.X300_TSPNF + z.X300_SPTNF + z.X300_WET + z.X300_WAT + z.X300_MF + z.X300_TSPS + z.X300_BAR + z.X300_TSPBDF + z.mean_elev_300 + z.mean_tri_300 + z.esker_dist_m + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk)

summary(glmm_wk_comm_bu)
```

wtarget
```{r}
glmm_wk_comm_bu_tgt <- glmer.nb(Caribou ~ 
                  z.X300_SPPGLM + z.X300_SPPSLM + z.X300_TSPNF + z.X300_SPTNF + z.X300_WET + z.X300_WAT + z.X300_MF + z.X300_TSPS + z.X300_BAR + z.X300_TSPBDF + z.mean_elev_300 + z.mean_tri_300 + z.esker_dist_m + target_cons + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk)

summary(glmm_wk_comm_bu_tgt)
```


#### Top Down

wout target
```{r}
glmm_wk_comm_td <- glmer.nb(Caribou ~ 
                  Gray.Wolf + Grizzly.Bear + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk)

summary(glmm_wk_comm_td)
```

w target
```{r}
glmm_wk_comm_td_tgt <- glmer.nb(Caribou ~ 
                  Gray.Wolf + Grizzly.Bear + target_cons  + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk)

summary(glmm_wk_comm_td_tgt)
```

####Apparent Competition

wout target
```{r}
glmm_wk_comm_app_tgt <- glmer.nb(Caribou ~ 
                  Muskox + Moose + Gray.Wolf + Grizzly.Bear + Muskox*Gray.Wolf + Muskox*Grizzly.Bear + Moose*Gray.Wolf + Moose*Grizzly.Bear + target_cons + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk)

summary(glmm_wk_comm_app_tgt)
```

w target
```{r}
glmm_wk_comm_app <- glmer.nb(Caribou ~ 
                  Muskox + Moose + Gray.Wolf + Grizzly.Bear + Muskox*Gray.Wolf + Muskox*Grizzly.Bear + Moose*Gray.Wolf + Moose*Grizzly.Bear + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk)

summary(glmm_wk_comm_app)
```

###Committee Model Selection
```{r}
model.sel(glmm_wk_random_eff, glmm_wk_fourssn, glmm_wk_tgtonly, glmm_wk_comm_bu, glmm_wk_comm_td, glmm_wk_comm_app, glmm_wk_comm_bu_tgt, glmm_wk_comm_td_tgt, glmm_wk_comm_app_tgt)
```

#############################################################################################

## Model Selection
```{r}
model.sel(glmm_wk_random, glmm_wk_random_eff, glmm_wk_snowssn, glmm_wk_fourssn, glmm_wk_wk, glmm_wk_lcc, glmm_wk_lcc_tundra, glmm_wk_dem, glmm_wk_tgt, glmm_wk_tgtonly, glmm_wk_pred, glmm_wk_ung, glmm_wk_cat2, glmm_wk_cat3, glmm_wk_comm_bu, glmm_wk_comm_td, glmm_wk_comm_app, glmm_wk_treeline)
```

  
############################################################################################################################################################################################################################
  
# Summer, WEEKLY detection data
```{r}
# Create a new data frame for summer
mod_dat_wk_summer <- mod_dat_wk[mod_dat_wk$four_season == "Summer", ]
```

let's try to map er out
```{r}
# Aggregate data by location to get total caribou detections
total_caribou_by_location <- mod_dat_wk_summer %>%
  group_by(location) %>%
  summarise(total_caribou = sum(Caribou))

# Merge total caribou detections with latitude and longitude data
locations <- mod_dat_wk_summer %>%
  distinct(location, latitude, longitude)

locations <- left_join(locations, total_caribou_by_location, by = "location") %>%
  mutate(has_detections = if_else(is.na(total_caribou) | total_caribou == 0, FALSE, TRUE))

# Create leaflet map
leaflet(locations) %>%
  addTiles() %>%
  addCircleMarkers(
    ~longitude, 
    ~latitude, 
    radius = ~if_else(has_detections, sqrt(total_caribou) * 2, 2), 
    color = ~if_else(has_detections, "blue", "grey"), 
    popup = ~paste("Location:", location, "<br>", "Total Caribou Detections:", total_caribou)
  )
```

##Target analysis
```{r}
#run anova to determine whether targets are actually significantly related to our response variable (Caribou occurrences in a given week at a given camera)

region_wk_smr_aov <- aov(Caribou ~ target_cons, data=mod_dat_wk_summer)
summary(region_wk_smr_aov)

# Perform Tukey's HSD test
tukey_results <- TukeyHSD(region_wk_smr_aov)

# View the results
print(tukey_results)
```

##Simple Models
```{r}
#null model
glmm_wk_smr_null <- glmer.nb(Caribou ~ 
                     offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_summer)
summary(glmm_wk_smr_null)
```

```{r}
#week model
glmm_wk_smr_wk <- glmer.nb(Caribou ~ 
                     week + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_summer)
summary(glmm_wk_smr_wk)
```

## LCC
run LCC model WITHOUT week
```{r}
glmm_wk_smr_lcc <- glmer.nb(Caribou ~ 
                    z.X300_SPPGLM + z.X300_SPPSLM + z.X300_TSPNF + z.X300_SPTNF + z.X300_WET + z.X300_WAT + z.X300_MF + z.X300_TSPS + z.X300_BAR + z.X300_TSPBDF + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_summer)

summary(glmm_wk_smr_lcc)
```

run LCC model WITH week
```{r}
#glmm_wk_smr_lccwk <- glmer.nb(Caribou ~ 
                    #z.X300_SPPGLM + z.X300_SPPSLM + z.X300_TSPNF + z.X300_SPTNF + z.X300_WET + z.X300_WAT + z.X300_MF + z.X300_TSPS + z.X300_BAR + z.X300_TSPBDF + week + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_summer)

#summary(glmm_wk_smr_lccwk)
```

### Tundra LCC
```{r}
glmm_wk_smr_lcc_tundra <- glmer.nb(Caribou ~ 
                    z.X300_SPPGLM + z.X300_SPPSLM + z.X300_WET + z.X300_WAT + z.X300_BAR + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_summer)

summary(glmm_wk_smr_lcc_tundra)
```

###Treeline DIstance
```{r}
glmm_wk_smr_treeline <- glmer.nb(Caribou ~ 
                    z.treeline_distance_m + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_summer)


summary(glmm_wk_smr_treeline)
```


## DEM

run dem model WITHOUT week
```{r}
glmm_wk_smr_dem <- glmer.nb(Caribou ~ 
                    z.mean_elev_300 + z.mean_tri_300 + z.esker_dist_m + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_summer)

summary(glmm_wk_smr_dem)
```

run dem model WITH week
```{r}
#glmm_wk_smr_demwk <- glmer.nb(Caribou ~ 
                    #z.mean_elev_300 + z.mean_tri_300 + offset(log(n_days_effort)) + week + (1|location_site) , data=mod_dat_wk_summer)

#summary(glmm_wk_smr_demwk)
```

## Target

target WITHOUT week
```{r}
glmm_wk_smr_other <- glmer.nb(Caribou ~ 
                     target_cons + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_summer)


summary(glmm_wk_smr_other)
```

target WITH week
```{r}
#glmm_wk_smr_otherwk <- glmer.nb(Caribou ~ 
                     #target_cons + week + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_summer)


#summary(glmm_wk_smr_otherwk)
```
Error in eval(mc, parent.frame(1L)) : 
  pwrssUpdate did not converge in (maxit) iterations

## Co-Occurrences

### Ungulates

How do those other ungulates effect caribou habitat use? WITHOUT week
```{r}
glmm_wk_smr_ung <- glmer.nb(Caribou ~ 
                    Muskox + Moose + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_summer)


summary(glmm_wk_smr_ung)
```

ungulates, WITH week
```{r}
#glmm_wk_smr_ungwk <- glmer.nb(Caribou ~ 
                    #Muskox + Moose + week + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_summer)


#summary(glmm_wk_smr_ungwk)
```
Error in eval(mc, parent.frame(1L)) : 
  pwrssUpdate did not converge in (maxit) iterations

### Predators

predators, WITHOUT week
```{r}
glmm_wk_smr_pred <- glmer.nb(Caribou ~ 
                    Gray.Wolf + Grizzly.Bear + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_summer)


summary(glmm_wk_smr_pred)
```

predators, WITH week
```{r}
#glmm_wk_smr_predwk <- glmer.nb(Caribou ~ 
                    #Gray.Wolf + Grizzly.Bear + Wolverine + week + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_summer)


#summary(glmm_wk_smr_predwk)
```
Error in eval(mc, parent.frame(1L)) : 
  pwrssUpdate did not converge in (maxit) iterations

## Significant Only

SIGNIFICANT ONLY
```{r}
glmm_wk_smr_sig <- glmer.nb(Caribou ~ 
                    Gray.Wolf + z.X300_SPPGLM + z.X300_SPPSLM + z.X300_WET + z.X300_WAT + z.X300_BAR + z.mean_elev_300 + z.esker_dist_m + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_summer)

summary(glmm_wk_smr_sig)
```

#############################################################################################

## DAG Models

Causal diagrams created using diggity to reduce bias and justify models based on hypothesized ecological processes. 

####Bottom Up

```{r}
glmm_wk_smr_dag_bu<- glmer.nb(Caribou ~ 
                              z.X300_SPPGLM + z.X300_SPPSLM + z.X300_BAR + z.X300_WAT + z.mean_elev_300 + z.esker_dist_m + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_summer)

summary(glmm_wk_smr_dag_bu)
```

####Top Down
```{r}
glmm_wk_smr_dag_td<- glmer.nb(Caribou ~ 
                              Gray.Wolf + Grizzly.Bear + z.X300_SPPGLM + z.X300_SPPSLM + z.X300_BAR + z.X300_WAT + z.esker_dist_m + target_cons + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_summer)

summary(glmm_wk_smr_dag_td)
```

####Apparent Competition

Models the total effect of Muskox and Moose on caribou while adjusting for water, wetland, and DEM covariates. Griz and Wolf didn't require adjustment but this model implies that heterospecific ungulates are acting on caribou through predators.

```{r}
glmm_wk_smr_dag_appa<- glmer.nb(Caribou ~ 
                              Muskox + Moose + z.X300_SPPGLM + z.X300_SPPSLM + z.X300_WET + z.X300_WAT + z.mean_elev_300 + target_cons + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_summer)

summary(glmm_wk_smr_dag_appa)
```

Compare with the model above. If wolf and griz have a strong effect here but ungulates don't have a strong effect above, the effect likely isn't due to apparent competition.
```{r}
glmm_wk_smr_dag_appb<- glmer.nb(Caribou ~ 
                              Gray.Wolf + Grizzly.Bear + z.X300_SPPGLM + z.X300_SPPSLM + z.X300_BAR + z.X300_WAT + z.mean_elev_300 + z.esker_dist_m + target_cons + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_summer)

summary(glmm_wk_smr_dag_appb)
```

###DAG Model Selection
```{r}
model.sel(glmm_wk_smr_dag_appa, glmm_wk_smr_dag_appb, glmm_wk_smr_dag_td, glmm_wk_smr_dag_bu)
```

#############################################################################################

## Committee Models

Uber simple models that the committee wants run on every data set and in every season

#### Bottom Up
```{r}
glmm_wk_smr_comm_bu <- glmer.nb(Caribou ~ 
                  z.X300_SPPGLM + z.X300_SPPSLM + z.X300_TSPNF + z.X300_SPTNF + z.X300_WET + z.X300_WAT + z.X300_MF + z.X300_TSPS + z.X300_BAR + z.X300_TSPBDF + z.mean_elev_300 + z.mean_tri_300 + z.esker_dist_m + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_summer)

summary(glmm_wk_smr_comm_bu)
```

#### Top Down
```{r}
glmm_wk_smr_comm_td <- glmer.nb(Caribou ~ 
                  Gray.Wolf + Grizzly.Bear + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_summer)

summary(glmm_wk_smr_comm_td)
```

####Apparent Competition
```{r}
glmm_wk_smr_comm_app <- glmer.nb(Caribou ~ 
                  Muskox + Moose + Gray.Wolf + Grizzly.Bear + Muskox*Gray.Wolf + Muskox*Grizzly.Bear + Moose*Gray.Wolf + Moose*Grizzly.Bear + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_summer)

summary(glmm_wk_smr_comm_app)
```

####Committee Model Selection
```{r}
model.sel(glmm_wk_smr_null, glmm_wk_smr_other, glmm_wk_smr_comm_bu, glmm_wk_smr_comm_td, glmm_wk_smr_comm_app)
```

#############################################################################################

## Model Selection
```{r}
model.sel(glmm_wk_smr_null, glmm_wk_smr_wk, glmm_wk_smr_lcc, glmm_wk_smr_lcc_tundra, glmm_wk_smr_dem, glmm_wk_smr_other, glmm_wk_smr_pred, glmm_wk_smr_ung, glmm_wk_smr_sig, glmm_wk_smr_dag_appa, glmm_wk_smr_dag_appb, glmm_wk_smr_dag_td, glmm_wk_smr_dag_bu, glmm_wk_smr_comm_bu, glmm_wk_smr_comm_td, glmm_wk_smr_comm_app, glmm_wk_smr_treeline)
```


############################################################################################################################################################################################################################

# Fall, WEEKLY detection data
```{r}
# Create a new data frame for winter
mod_dat_wk_fall <- mod_dat_wk[mod_dat_wk$four_season == "Fall", ]
```

plot it out
```{r}
# Aggregate data by location to get total caribou detections
total_caribou_by_location <- mod_dat_wk_fall %>%
  group_by(location) %>%
  summarise(total_caribou = sum(Caribou))

# Merge total caribou detections with latitude and longitude data
locations <- mod_dat_wk_fall %>%
  distinct(location, latitude, longitude)

locations <- left_join(locations, total_caribou_by_location, by = "location") %>%
  mutate(has_detections = if_else(is.na(total_caribou) | total_caribou == 0, FALSE, TRUE))

# Create leaflet map
leaflet(locations) %>%
  addTiles() %>%
  addCircleMarkers(
    ~longitude, 
    ~latitude, 
    radius = ~if_else(has_detections, sqrt(total_caribou) * 2, 2), 
    color = ~if_else(has_detections, "blue", "grey"), 
    popup = ~paste("Location:", location, "<br>", "Total Caribou Detections:", total_caribou)
  )
```

##Target analysis
```{r}
#run anova to determine whether targets are actually significantly related to our response variable (Caribou occurrences in a given week at a given camera)

region_wk_fll_aov <- aov(Caribou ~ target_cons, data=mod_dat_wk_fall)
summary(region_wk_fll_aov)

# Perform Tukey's HSD test
tukey_results <- TukeyHSD(region_wk_fll_aov)

# View the results
print(tukey_results)
```

##Simple Models
```{r}
#null model
glmm_wk_fall_null <- glmer.nb(Caribou ~ 
                     offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_fall)
summary(glmm_wk_fall_null)
```

```{r}
#week model
glmm_wk_fall_wk <- glmer.nb(Caribou ~ 
                     week + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_fall)
summary(glmm_wk_fall_wk)
```

## LCC
run LCC model WITHOUT week
```{r}
glmm_wk_fall_lcc <- glmer.nb(Caribou ~ 
                    z.X300_SPPGLM + z.X300_SPPSLM + z.X300_TSPNF + z.X300_SPTNF + z.X300_WET + z.X300_WAT + z.X300_MF + z.X300_TSPS + z.X300_BAR + z.X300_TSPBDF + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_fall)

summary(glmm_wk_fall_lcc)
```

run LCC model WITH week
```{r}
#glmm_wk_fall_lccwk <- glmer.nb(Caribou ~ 
                    #z.X300_SPPGLM + z.X300_SPPSLM + z.X300_TSPNF + z.X300_SPTNF + z.X300_WET + z.X300_WAT + z.X300_MF + z.X300_TSPS + z.X300_BAR + z.X300_TSPBDF + week + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_fall)

#summary(glmm_wk_fall_lccwk)
```

### Tundra LCC
```{r}
glmm_wk_fall_lcc_tundra <- glmer.nb(Caribou ~ 
                    z.X300_SPPGLM + z.X300_SPPSLM + z.X300_WET + z.X300_WAT + z.X300_BAR + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_fall)

summary(glmm_wk_fall_lcc_tundra)
```

###Treeline Distance
```{r}
glmm_wk_fall_treeline <- glmer.nb(Caribou ~ 
                    z.treeline_distance_m + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_fall)


summary(glmm_wk_fall_treeline)
```


## DEM

run dem model WITHOUT week
```{r}
glmm_wk_fall_dem <- glmer.nb(Caribou ~ 
                    z.mean_elev_300 + z.mean_tri_300 + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_fall)

summary(glmm_wk_fall_dem)
```

run dem model WITH week
```{r}
#glmm_wk_fall_demwk <- glmer.nb(Caribou ~ 
                    #z.mean_elev_300 + z.mean_tri_300 + offset(log(n_days_effort)) + week + (1|location_site) , data=mod_dat_wk_fall)

#summary(glmm_wk_fall_demwk)
```

## Target

target WITHOUT week
```{r}
glmm_wk_fall_tgt <- glmer.nb(Caribou ~ 
                     target_cons + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_fall)


summary(glmm_wk_fall_tgt)
```

target WITH week
```{r}
#glmm_wk_wtr_otherwk <- glmer.nb(Caribou ~ 
                     #target_cons + week + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_winter)


#summary(glmm_wk_wtr_otherwk)
```
Error in eval(mc, parent.frame(1L)) : 
  pwrssUpdate did not converge in (maxit) iterations

## Co-occurrences

### Ungulates

How do those other ungulates effect caribou habitat use? WITHOUT week
```{r}
glmm_wk_fall_ung <- glmer.nb(Caribou ~ 
                    Muskox + Moose + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_fall)


summary(glmm_wk_fall_ung)
```

ungulates, WITH week
```{r}
#glmm_wk_wtr_ungwk <- glmer.nb(Caribou ~ 
                    #Muskox + Moose + week + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_winter)


#summary(glmm_wk_wtr_ungwk)
```
Error in eval(mc, parent.frame(1L)) : 
  pwrssUpdate did not converge in (maxit) iterations

### Predators

predators, WITHOUT week
```{r}
glmm_wk_fall_pred <- glmer.nb(Caribou ~ 
                    Gray.Wolf + Grizzly.Bear + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_fall)


summary(glmm_wk_fall_pred)
```

predators, WITH week
```{r}
#glmm_wk_wtr_predwk <- glmer.nb(Caribou ~ 
                    #Gray.Wolf + Grizzly.Bear + Wolverine + week + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_winter)


#summary(glmm_wk_wtr_predwk)
```
Error in eval(mc, parent.frame(1L)) : 
  pwrssUpdate did not converge in (maxit) iterations


## Significant Only

SIGNIFICANT ONLY
```{r}
glmm_wk_fall_sig <- glmer.nb(Caribou ~ 
                    Gray.Wolf + z.X300_SPPGLM + z.X300_SPPSLM + z.X300_WET + z.X300_WAT + z.X300_BAR + z.mean_elev_300 + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_fall)

summary(glmm_wk_fall_sig)
```

#############################################################################################

## DAG Models

Causal diagrams created using diggity to reduce bias and justify models based on hypothesized ecological processes. 

####Bottom Up

```{r}
glmm_wk_fall_dag_bu<- glmer.nb(Caribou ~ 
                              z.X300_SPPGLM + z.X300_SPPSLM + z.X300_BAR + z.X300_WET + z.X300_WAT + z.mean_elev_300 + z.mean_tri_300 + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_fall)

summary(glmm_wk_fall_dag_bu)
```

####Top Down
```{r}
glmm_wk_fall_dag_td<- glmer.nb(Caribou ~ 
                              Gray.Wolf + Grizzly.Bear + z.X300_SPPGLM + z.X300_SPPSLM + z.X300_BAR  + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_fall)

summary(glmm_wk_fall_dag_td)
```

####Apparent Competition

Models the total effect of Muskox and Moose on caribou while adjusting for water, wetland, and DEM covariates. Griz and Wolf didn't require adjustment but this model implies that heterospecific ungulates are acting on caribou through predators.

```{r}
glmm_wk_fall_dag_appa<- glmer.nb(Caribou ~ 
                              Muskox + Moose + z.X300_WET + z.X300_WAT + z.mean_elev_300 + z.mean_tri_300 + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_fall)

summary(glmm_wk_fall_dag_appa)
```

Compare with the model above. If wolf and griz have a strong effect here but ungulates don't have a strong effect above, the effect likely isn't due to apparent competition.
```{r}
glmm_wk_fall_dag_appb<- glmer.nb(Caribou ~ 
                              Gray.Wolf + Grizzly.Bear + z.X300_SPPGLM + z.X300_SPPSLM + z.X300_BAR + z.X300_WET + z.X300_WAT + z.mean_elev_300 + z.mean_tri_300 + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_fall)

summary(glmm_wk_fall_dag_appb)
```

###DAG Model Selection
```{r}
model.sel(glmm_wk_fall_dag_appa, glmm_wk_fall_dag_appb, glmm_wk_fall_dag_td, glmm_wk_fall_dag_bu)
```

#############################################################################################

## Committee Models

Uber simple models that the committee wants run on every data set and in every season

#### Bottom Up

```{r}
glmm_wk_fll_comm_bu <- glmer.nb(Caribou ~ 
                  z.X300_SPPGLM + z.X300_SPPSLM + z.X300_TSPNF + z.X300_SPTNF + z.X300_WET + z.X300_WAT + z.X300_MF + z.X300_TSPS + z.X300_BAR + z.X300_TSPBDF + z.mean_elev_300 + z.mean_tri_300 + z.esker_dist_m + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_fall)

summary(glmm_wk_fll_comm_bu)
```

#### Top Down

```{r}
glmm_wk_fll_comm_td <- glmer.nb(Caribou ~ 
                  Gray.Wolf + Grizzly.Bear + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_fall)

summary(glmm_wk_fll_comm_td)
```

####Apparent Competition

```{r}
glmm_wk_fll_comm_app <- glmer.nb(Caribou ~ 
                  Muskox + Moose + Gray.Wolf + Grizzly.Bear + Muskox*Gray.Wolf + Muskox*Grizzly.Bear + Moose*Gray.Wolf + Moose*Grizzly.Bear + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_fall)

summary(glmm_wk_fll_comm_app)
```

####Committee Model Selection
```{r}
model.sel(glmm_wk_fall_null, glmm_wk_fall_tgt, glmm_wk_fll_comm_bu, glmm_wk_fll_comm_td, glmm_wk_fll_comm_app)
```

#############################################################################################

## Model Selection
```{r}
model.sel(glmm_wk_fall_null, glmm_wk_fall_wk, glmm_wk_fall_lcc, glmm_wk_fall_lcc_tundra, glmm_wk_fall_dem, glmm_wk_fall_tgt, glmm_wk_fall_pred, glmm_wk_fall_ung, glmm_wk_fall_sig, glmm_wk_fall_dag_appa, glmm_wk_fall_dag_appb, glmm_wk_fall_dag_td, glmm_wk_fall_dag_bu, glmm_wk_fll_comm_bu, glmm_wk_fll_comm_td, glmm_wk_fll_comm_app, glmm_wk_fall_treeline)
```


################################################################################################################################################################################################################################################

# Winter, WEEKLY detection data
```{r}
# Create a new data frame for winter
mod_dat_wk_winter <- mod_dat_wk[mod_dat_wk$four_season == "Winter", ]
```

plot it out
```{r}
# Aggregate data by location to get total caribou detections
total_caribou_by_location <- mod_dat_wk_winter %>%
  group_by(location) %>%
  summarise(total_caribou = sum(Caribou))

# Merge total caribou detections with latitude and longitude data
locations <- mod_dat_wk_winter %>%
  distinct(location, latitude, longitude)

locations <- left_join(locations, total_caribou_by_location, by = "location") %>%
  mutate(has_detections = if_else(is.na(total_caribou) | total_caribou == 0, FALSE, TRUE))

# Create leaflet map
leaflet(locations) %>%
  addTiles() %>%
  addCircleMarkers(
    ~longitude, 
    ~latitude, 
    radius = ~if_else(has_detections, sqrt(total_caribou) * 2, 2), 
    color = ~if_else(has_detections, "blue", "grey"), 
    popup = ~paste("Location:", location, "<br>", "Total Caribou Detections:", total_caribou)
  )
```

##Target analysis
```{r}
#run anova to determine whether targets are actually significantly related to our response variable (Caribou occurrences in a given week at a given camera)

region_wk_wtr_aov <- aov(Caribou ~ target_cons, data=mod_dat_wk_winter)
summary(region_wk_wtr_aov)

# Perform Tukey's HSD test
tukey_results <- TukeyHSD(region_wk_wtr_aov)

# View the results
print(tukey_results)
```

##Simple Models
```{r}
#null model
glmm_wk_wtr_null <- glmer.nb(Caribou ~ 
                     offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_winter)
summary(glmm_wk_wtr_null)
```

```{r}
#week model
glmm_wk_wtr_wk <- glmer.nb(Caribou ~ 
                     week + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_winter)
summary(glmm_wk_wtr_wk)
```

## LCC
run LCC model WITHOUT week
```{r}
glmm_wk_wtr_lcc <- glmer.nb(Caribou ~ 
                    z.X300_SPPGLM + z.X300_SPPSLM + z.X300_TSPNF + z.X300_SPTNF + z.X300_WET + z.X300_WAT + z.X300_MF + z.X300_TSPS + z.X300_BAR + z.X300_TSPBDF + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_winter)

summary(glmm_wk_wtr_lcc)
```

run LCC model WITH week
```{r}
#glmm_wk_wtr_lccwk <- glmer.nb(Caribou ~ 
                    #z.X300_SPPGLM + z.X300_SPPSLM + z.X300_TSPNF + z.X300_SPTNF + z.X300_WET + z.X300_WAT + z.X300_MF + z.X300_TSPS + z.X300_BAR + z.X300_TSPBDF + week + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_winter)

#summary(glmm_wk_wtr_lccwk)
```

### Tundra LCC
```{r}
glmm_wk_wtr_lcc_tundra <- glmer.nb(Caribou ~ 
                    z.X300_SPPGLM + z.X300_SPPSLM + z.X300_WET + z.X300_WAT + z.X300_BAR + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_winter)

summary(glmm_wk_wtr_lcc_tundra)
```

###Treeline Distance
```{r}
glmm_wk_wtr_treeline <- glmer.nb(Caribou ~ 
                    z.treeline_distance_m + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_winter)


summary(glmm_wk_wtr_treeline)
```


## DEM

run dem model WITHOUT week
```{r}
glmm_wk_wtr_dem <- glmer.nb(Caribou ~ 
                    z.mean_elev_300 + z.mean_tri_300 + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_winter)

summary(glmm_wk_wtr_dem)
```

run dem model WITH week
```{r}
#glmm_wk_wtr_demwk <- glmer.nb(Caribou ~ 
                    #z.mean_elev_300 + z.mean_tri_300 + offset(log(n_days_effort)) + week + (1|location_site) , data=mod_dat_wk_winter)

#summary(glmm_wk_wtr_demwk)
```

## Target

target WITHOUT week
```{r}
glmm_wk_wtr_other <- glmer.nb(Caribou ~ 
                     target_cons + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_winter)


summary(glmm_wk_wtr_other)
```

target WITH week
```{r}
#glmm_wk_wtr_otherwk <- glmer.nb(Caribou ~ 
                     #target_cons + week + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_winter)


#summary(glmm_wk_wtr_otherwk)
```
Error in eval(mc, parent.frame(1L)) : 
  pwrssUpdate did not converge in (maxit) iterations

## Co-occurrences

### Ungulates

How do those other ungulates effect caribou habitat use? WITHOUT week
```{r}
glmm_wk_wtr_ung <- glmer.nb(Caribou ~ 
                    Muskox + Moose + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_winter)


summary(glmm_wk_wtr_ung)
```

ungulates, WITH week
```{r}
#glmm_wk_wtr_ungwk <- glmer.nb(Caribou ~ 
                    #Muskox + Moose + week + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_winter)


#summary(glmm_wk_wtr_ungwk)
```
Error in eval(mc, parent.frame(1L)) : 
  pwrssUpdate did not converge in (maxit) iterations

### Predators

predators, WITHOUT week
```{r}
glmm_wk_wtr_pred <- glmer.nb(Caribou ~ 
                    Gray.Wolf + Grizzly.Bear + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_winter)


summary(glmm_wk_wtr_pred)
```

predators, WITH week
```{r}
#glmm_wk_wtr_predwk <- glmer.nb(Caribou ~ 
                    #Gray.Wolf + Grizzly.Bear + Wolverine + week + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_winter)


#summary(glmm_wk_wtr_predwk)
```
Error in eval(mc, parent.frame(1L)) : 
  pwrssUpdate did not converge in (maxit) iterations


## Significant Only

SIGNIFICANT ONLY
```{r}
glmm_wk_wtr_sig <- glmer.nb(Caribou ~ 
                    Gray.Wolf + z.X300_SPPGLM + z.X300_SPPSLM + z.X300_WET + z.X300_WAT + z.X300_BAR + z.mean_elev_300 + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_winter)

summary(glmm_wk_wtr_sig)
```

wout elevation which stopped showing as signif
```{r}
glmm_wk_wtr_sig2 <- glmer.nb(Caribou ~ 
                    Gray.Wolf + z.X300_SPPGLM + z.X300_SPPSLM + z.X300_WET + z.X300_WAT + z.X300_BAR + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_winter)

summary(glmm_wk_wtr_sig2)
```

#############################################################################################

## DAG Models

Causal diagrams created using diggity to reduce bias and justify models based on hypothesized ecological processes. 

####Bottom Up

```{r}
glmm_wk_wtr_dag_bu<- glmer.nb(Caribou ~ 
                              z.X300_SPPGLM + z.X300_SPPSLM + z.X300_BAR + z.X300_WET + z.X300_WAT + z.mean_elev_300 + z.mean_tri_300 + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_winter)

summary(glmm_wk_wtr_dag_bu)
```

####Top Down
```{r}
glmm_wk_wtr_dag_td<- glmer.nb(Caribou ~ 
                              Gray.Wolf + Grizzly.Bear + z.X300_SPPGLM + z.X300_SPPSLM + z.X300_BAR  + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_winter)

summary(glmm_wk_wtr_dag_td)
```

####Apparent Competition

Models the total effect of Muskox and Moose on caribou while adjusting for water, wetland, and DEM covariates. Griz and Wolf didn't require adjustment but this model implies that heterospecific ungulates are acting on caribou through predators.

```{r}
glmm_wk_wtr_dag_appa<- glmer.nb(Caribou ~ 
                              Muskox + Moose + z.X300_WET + z.X300_WAT + z.mean_elev_300 + z.mean_tri_300 + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_winter)

summary(glmm_wk_wtr_dag_appa)
```

Compare with the model above. If wolf and griz have a strong effect here but ungulates don't have a strong effect above, the effect likely isn't due to apparent competition.
```{r}
glmm_wk_wtr_dag_appb<- glmer.nb(Caribou ~ 
                              Gray.Wolf + Grizzly.Bear + z.X300_SPPGLM + z.X300_SPPSLM + z.X300_BAR + z.X300_WET + z.X300_WAT + z.mean_elev_300 + z.mean_tri_300 +offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_winter)

summary(glmm_wk_wtr_dag_appb)
```

###DAG Model Selection
```{r}
model.sel(glmm_wk_wtr_dag_appa, glmm_wk_wtr_dag_appb, glmm_wk_wtr_dag_td, glmm_wk_wtr_dag_bu)
```

#############################################################################################

## Committee Models

Uber simple models that the committee wants run on every data set and in every season

#### Bottom Up

```{r}
glmm_wk_wtr_comm_bu <- glmer.nb(Caribou ~ 
                  z.X300_SPPGLM + z.X300_SPPSLM + z.X300_TSPNF + z.X300_SPTNF + z.X300_WET + z.X300_WAT + z.X300_MF + z.X300_TSPS + z.X300_BAR + z.X300_TSPBDF + z.mean_elev_300 + z.mean_tri_300 + z.esker_dist_m + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_winter)

summary(glmm_wk_wtr_comm_bu)
```

#### Top Down

```{r}
glmm_wk_wtr_comm_td <- glmer.nb(Caribou ~ 
                  Gray.Wolf + Grizzly.Bear + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_winter)

summary(glmm_wk_wtr_comm_td)
```

####Apparent Competition

```{r}
glmm_wk_wtr_comm_app <- glmer.nb(Caribou ~ 
                  Muskox + Moose + Gray.Wolf + Grizzly.Bear + Muskox*Gray.Wolf + Muskox*Grizzly.Bear + Moose*Gray.Wolf + Moose*Grizzly.Bear + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_winter)

summary(glmm_wk_wtr_comm_app)
```

####Committee Model Selection
```{r}
model.sel(glmm_wk_wtr_null, glmm_wk_wtr_other, glmm_wk_wtr_comm_bu, glmm_wk_wtr_comm_td, glmm_wk_wtr_comm_app)
```

#############################################################################################

## Model Selection
```{r}
model.sel(glmm_wk_wtr_null, glmm_wk_wtr_wk, glmm_wk_wtr_lcc, glmm_wk_wtr_lcc_tundra, glmm_wk_wtr_dem, glmm_wk_wtr_other, glmm_wk_wtr_pred, glmm_wk_wtr_ung, glmm_wk_wtr_sig, glmm_wk_wtr_sig2, glmm_wk_wtr_dag_appa, glmm_wk_wtr_dag_appb, glmm_wk_wtr_dag_td, glmm_wk_wtr_dag_bu, glmm_wk_wtr_comm_bu, glmm_wk_wtr_comm_td, glmm_wk_wtr_comm_app, glmm_wk_wtr_treeline)
```

############################################################################################################################################################################################################################

# Spring, WEEKLY detection data
```{r}
# Create a new data frame for winter
mod_dat_wk_spri <- mod_dat_wk[mod_dat_wk$four_season == "Spring", ]
```

plot it out
```{r}
# Aggregate data by location to get total caribou detections
total_caribou_by_location <- mod_dat_wk_spri %>%
  group_by(location) %>%
  summarise(total_caribou = sum(Caribou))

# Merge total caribou detections with latitude and longitude data
locations <- mod_dat_wk_spri %>%
  distinct(location, latitude, longitude)

locations <- left_join(locations, total_caribou_by_location, by = "location") %>%
  mutate(has_detections = if_else(is.na(total_caribou) | total_caribou == 0, FALSE, TRUE))

# Create leaflet map
leaflet(locations) %>%
  addTiles() %>%
  addCircleMarkers(
    ~longitude, 
    ~latitude, 
    radius = ~if_else(has_detections, sqrt(total_caribou) * 2, 2), 
    color = ~if_else(has_detections, "blue", "grey"), 
    popup = ~paste("Location:", location, "<br>", "Total Caribou Detections:", total_caribou)
  )
```

##Target analysis
```{r}
#run anova to determine whether targets are actually significantly related to our response variable (Caribou occurrences in a given week at a given camera)

region_wk_spr_aov <- aov(Caribou ~ target_cons, data=mod_dat_wk_spri)
summary(region_wk_spr_aov)

# Perform Tukey's HSD test
tukey_results <- TukeyHSD(region_wk_spr_aov)

# View the results
print(tukey_results)
```

##Simple Models
```{r}
#null model
glmm_wk_spri_null <- glmer.nb(Caribou ~ 
                     offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_spri)
summary(glmm_wk_spri_null)
```

```{r}
#week model
glmm_wk_spri_wk <- glmer.nb(Caribou ~ 
                     week + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_spri)
summary(glmm_wk_spri_wk)
```

## LCC
run LCC model WITHOUT week
```{r}
glmm_wk_spri_lcc <- glmer.nb(Caribou ~ 
                    z.X300_SPPGLM + z.X300_SPPSLM + z.X300_TSPNF + z.X300_SPTNF + z.X300_WET + z.X300_WAT + z.X300_MF + z.X300_TSPS + z.X300_BAR + z.X300_TSPBDF + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_spri)

summary(glmm_wk_spri_lcc)
```

run LCC model WITH week
```{r}
#glmm_wk_spri_lccwk <- glmer.nb(Caribou ~ 
                    #z.X300_SPPGLM + z.X300_SPPSLM + z.X300_TSPNF + z.X300_SPTNF + z.X300_WET + z.X300_WAT + z.X300_MF + z.X300_TSPS + z.X300_BAR + z.X300_TSPBDF + week + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_spri)

#summary(glmm_wk_spri_lccwk)
```

### Tundra LCC
```{r}
glmm_wk_spri_lcc_tundra <- glmer.nb(Caribou ~ 
                    z.X300_SPPGLM + z.X300_SPPSLM + z.X300_WET + z.X300_WAT + z.X300_BAR + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_spri)

summary(glmm_wk_fall_lcc_tundra)
```

###Treeline Distance
```{r}
glmm_wk_spri_treeline <- glmer.nb(Caribou ~ 
                    z.treeline_distance_m + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_spri)


summary(glmm_wk_spri_treeline)
```

## DEM

run dem model WITHOUT week
```{r}
glmm_wk_spri_dem <- glmer.nb(Caribou ~ 
                    z.mean_elev_300 + z.mean_tri_300 + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_spri)

summary(glmm_wk_spri_dem)
```

run dem model WITH week
```{r}
#glmm_wk_spri_demwk <- glmer.nb(Caribou ~ 
                    #z.mean_elev_300 + z.mean_tri_300 + offset(log(n_days_effort)) + week + (1|location_site) , data=mod_dat_wk_spri)

#summary(glmm_wk_spri_demwk)
```

## Target

target WITHOUT week
```{r}
glmm_wk_spri_tgt <- glmer.nb(Caribou ~ 
                     target_cons + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_spri)


summary(glmm_wk_spri_tgt)
```

target WITH week
```{r}
#glmm_wk_wtr_otherwk <- glmer.nb(Caribou ~ 
                     #target_cons + week + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_winter)


#summary(glmm_wk_wtr_otherwk)
```
Error in eval(mc, parent.frame(1L)) : 
  pwrssUpdate did not converge in (maxit) iterations

## Co-occurrences

### Ungulates

How do those other ungulates effect caribou habitat use? WITHOUT week
```{r}
glmm_wk_spri_ung <- glmer.nb(Caribou ~ 
                    Muskox + Moose + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_spri)


summary(glmm_wk_spri_ung)
```

ungulates, WITH week
```{r}
#glmm_wk_wtr_ungwk <- glmer.nb(Caribou ~ 
                    #Muskox + Moose + week + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_winter)


#summary(glmm_wk_wtr_ungwk)
```
Error in eval(mc, parent.frame(1L)) : 
  pwrssUpdate did not converge in (maxit) iterations

### Predators

predators, WITHOUT week
```{r}
glmm_wk_spri_pred <- glmer.nb(Caribou ~ 
                    Gray.Wolf + Grizzly.Bear + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_spri)


summary(glmm_wk_spri_pred)
```

predators, WITH week
```{r}
#glmm_wk_wtr_predwk <- glmer.nb(Caribou ~ 
                    #Gray.Wolf + Grizzly.Bear + Wolverine + week + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_winter)


#summary(glmm_wk_wtr_predwk)
```
Error in eval(mc, parent.frame(1L)) : 
  pwrssUpdate did not converge in (maxit) iterations

## Significant Only

SIGNIFICANT ONLY
```{r}
glmm_wk_spri_sig <- glmer.nb(Caribou ~ 
                    Gray.Wolf + z.X300_SPPGLM + z.X300_SPPSLM + z.X300_WET + z.X300_WAT + z.X300_BAR + z.mean_elev_300 + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_spri)

summary(glmm_wk_spri_sig)
```


add MF and remove wolf and elev???
```{r}
glmm_wk_spri_sig2 <- glmer.nb(Caribou ~ 
                    z.X300_SPPGLM + z.X300_SPPSLM + z.X300_WET + z.X300_WAT + z.X300_BAR + z.X300_MF + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_spri)

summary(glmm_wk_spri_sig2)
```

#############################################################################################

## DAG Models

Causal diagrams created using diggity to reduce bias and justify models based on hypothesized ecological processes. 

####Bottom Up

```{r}
glmm_wk_spri_dag_bu<- glmer.nb(Caribou ~ 
                              z.X300_SPPGLM + z.X300_SPPSLM + z.X300_BAR + z.X300_WET + z.X300_WAT + z.mean_elev_300 + z.mean_tri_300 + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_spri)

summary(glmm_wk_spri_dag_bu)
```

####Top Down
```{r}
glmm_wk_spri_dag_td<- glmer.nb(Caribou ~ 
                              Gray.Wolf + Grizzly.Bear + z.X300_SPPGLM + z.X300_SPPSLM + z.X300_BAR  + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_spri)

summary(glmm_wk_spri_dag_td)
```

####Apparent Competition

Models the total effect of Muskox and Moose on caribou while adjusting for water, wetland, and DEM covariates. Griz and Wolf didn't require adjustment but this model implies that heterospecific ungulates are acting on caribou through predators.

```{r}
glmm_wk_spri_dag_appa<- glmer.nb(Caribou ~ 
                              Muskox + Moose + z.X300_WET + z.X300_WAT + z.mean_elev_300 + z.mean_tri_300 + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_spri)

summary(glmm_wk_spri_dag_appa)
```

Compare with the model above. If wolf and griz have a strong effect here but ungulates don't have a strong effect above, the effect likely isn't due to apparent competition.
```{r}
glmm_wk_spri_dag_appb<- glmer.nb(Caribou ~ 
                              Gray.Wolf + Grizzly.Bear + z.X300_SPPGLM + z.X300_SPPSLM + z.X300_BAR + z.X300_WET + z.X300_WAT + z.mean_elev_300 + z.mean_tri_300 +offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_spri)

summary(glmm_wk_spri_dag_appb)
```

###DAG Model Selection
```{r}
model.sel(glmm_wk_spri_dag_appa, glmm_wk_spri_dag_appb, glmm_wk_spri_dag_td, glmm_wk_spri_dag_bu)
```

#############################################################################################

## Committee Models

Uber simple models that the committee wants run on every data set and in every season

#### Bottom Up

```{r}
glmm_wk_spr_comm_bu <- glmer.nb(Caribou ~ 
                  z.X300_SPPGLM + z.X300_SPPSLM + z.X300_TSPNF + z.X300_SPTNF + z.X300_WET + z.X300_WAT + z.X300_MF + z.X300_TSPS + z.X300_BAR + z.X300_TSPBDF + z.mean_elev_300 + z.mean_tri_300 + z.esker_dist_m + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_spri)

summary(glmm_wk_spr_comm_bu)
```

#### Top Down

```{r}
glmm_wk_spr_comm_td <- glmer.nb(Caribou ~ 
                  Gray.Wolf + Grizzly.Bear + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_spri)

summary(glmm_wk_spr_comm_td)
```

####Apparent Competition

```{r}
glmm_wk_spr_comm_app <- glmer.nb(Caribou ~ 
                  Muskox + Moose + Gray.Wolf + Grizzly.Bear + Muskox*Gray.Wolf + Muskox*Grizzly.Bear + Moose*Gray.Wolf + Moose*Grizzly.Bear + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_spri)

summary(glmm_wk_spr_comm_app)
```

####Committee Model Selection
```{r}
model.sel(glmm_wk_spri_null, glmm_wk_spri_tgt, glmm_wk_spr_comm_bu, glmm_wk_spr_comm_td, glmm_wk_spr_comm_app)
```


#############################################################################################

## Model Selection
```{r}
model.sel(glmm_wk_spri_null, glmm_wk_spri_wk, glmm_wk_spri_lcc, glmm_wk_spri_lcc_tundra, glmm_wk_spri_dem, glmm_wk_spri_tgt, glmm_wk_spri_pred, glmm_wk_spri_ung, glmm_wk_spri_sig, glmm_wk_spri_sig2, glmm_wk_spri_dag_appa, glmm_wk_spri_dag_appb, glmm_wk_spri_dag_td, glmm_wk_spri_dag_bu, glmm_wk_spr_comm_bu, glmm_wk_spr_comm_td, glmm_wk_spr_comm_app, glmm_wk_spri_treeline)
```


########################################################################################################################################################################################################################################################################################################################################################################

# Caribou Sites Only

Subset detection data to only the clusters which captured caribou at a least one of their cameras. Must be subset after joining with covariates to filter by location_site. Must decide on response variable time (i.e. week, biweek) before trying this to cut down on time. 

I think weekly is probably the way to go. it's a good balance of high detail without being so coarse as to become irrelevant for species co-occurrences. It also provides adequate survey replicas when running 4 separate seasonal models

##UPDATE: 2024-03-21 ##############################################################################

Realized that you can't just subset the data based on caribou detections being greater than 1 because you want to keep ALL cameras and ALL sampling periods at clusters with at least one caribou, whereas the original code was only taking the cameras/sampling periods with caribou and dumping everything else. Need to figure out how to keep only those cameras (i.e. location) which had at least 1 caribou detection at the cluster level (i.e. location_site)

OKAY I THINK I FIXED IT.

weekly caribou data
```{r}
# Filter rows where "Caribou" is greater than or equal to 1
caribou_data <- mod_dat_wk %>%
  filter(Caribou >= 1) %>%
  dplyr::select(location, location_site) %>%
  distinct()

# Filter mod_dat_wk for rows with locations that have caribou detections or share the same location_site
mod_dat_wk_cbou <- mod_dat_wk %>%
  filter(location %in% caribou_data$location | location_site %in% caribou_data$location_site)

```

Better to use biological rationale for choosing the local sites rather than a detection based criteria. Proportion of "TUNDRA" vs "TAIGA"? Compare with locations from caribou based data above
```{r}
# Create a new dataframe with rows where z.TUNDRA > z.TAIGA
mod_dat_wk_tundra <- mod_dat_wk %>%
  filter(z.TUNDRA > z.TAIGA)
```

Compare with locations from caribou detection filtered data
```{r}
# Get unique locations in mod_dat_wk_tundra
unique_locations_tundra <- unique(mod_dat_wk_tundra$location)

# Get unique locations in mod_dat_wk_cbou
unique_locations_cbou <- unique(mod_dat_wk_cbou$location)

# Compare unique locations
common_locations <- intersect(unique_locations_tundra, unique_locations_cbou)
only_in_tundra <- setdiff(unique_locations_tundra, unique_locations_cbou)
only_in_cbou <- setdiff(unique_locations_cbou, unique_locations_tundra)

# Output the results
cat("Common locations:", common_locations, "\n")
cat("Locations only in mod_dat_wk_tundra:", only_in_tundra, "\n")
cat("Locations only in mod_dat_wk_cbou:", only_in_cbou, "\n")

```

Map it out to see the cameras visually 
```{r}
# Create a leaflet map
map <- leaflet() %>%
  addTiles() %>%
  addCircleMarkers(data = mod_dat_wk_tundra[mod_dat_wk_tundra$location %in% common_locations,],
                   lat = ~latitude,
                   lng = ~longitude,
                   label = ~paste(location, " (Common)"),
                   color = "blue",
                   radius = 5) %>%
  addCircleMarkers(data = mod_dat_wk_cbou[mod_dat_wk_cbou$location %in% common_locations,],
                   lat = ~latitude,
                   lng = ~longitude,
                   label = ~paste(location, " (Common)"),
                   color = "red",
                   radius = 5) %>%
  addCircleMarkers(data = mod_dat_wk_tundra[mod_dat_wk_tundra$location %in% unique_locations_tundra,],
                   lat = ~latitude,
                   lng = ~longitude,
                   label = ~paste(location, " (Tundra)"),
                   color = "green",
                   radius = 5) %>%
  addCircleMarkers(data = mod_dat_wk_cbou[mod_dat_wk_cbou$location %in% unique_locations_cbou,],
                   lat = ~latitude,
                   lng = ~longitude,
                   label = ~paste(location, " (Caribou)"),
                   color = "orange",
                   radius = 5) %>%
  addLegend("bottomright",
            colors = c("blue", "red", "green", "orange"),
            labels = c("Common (Tundra)", "Common (Caribou)", "Unique (Tundra)", "Unique (Caribou)"))

# Print the map
map
```
Very annoyingly, there is one single camera with caribou detections which is not in a majority tundra-type landcover area.

BIO-TDN-050-06 has only two independent detections, both on 2021-11-24, first of a large bachelor group during the day and next of two females that night. Right in the transitional area between tundra and taiga but the camera micro site is very much needle leaf forest.

#############################################################################################

# Local, Multiseason, WEEK

##Target analysis
```{r}
# Reorder the levels of the target_cons column
mod_dat_wk_cbou$target_cons <- fct_relevel(mod_dat_wk_cbou$target_cons, "None")

#check the levels were reordered correctly. None should be first to act as the control feature. 
levels(mod_dat_wk_cbou$target_cons)

# Group by target_cons and count unique locations within each group
unique_cbou_locations_by_target <- mod_dat_wk_cbou %>%
  group_by(target_cons) %>%
  summarise(unique_locations = n_distinct(location))

# Print the result
print(unique_cbou_locations_by_target)

#run anova to determine whether targets are actually significantly related to our response variable (Caribou occurrences in a given week at a given camera)

region_wk_cbou_aov <- aov(Caribou ~ target_cons, data=mod_dat_wk_cbou)
summary(region_wk_cbou_aov)
```

interpret the results
```{r}
# Perform Tukey's HSD test
tukey_results <- TukeyHSD(region_wk_cbou_aov)

# View the results
print(tukey_results)
```

###Simple Models
```{r}
# GLMM with only a random effect
glmm_wk_cbou_random <- glmer.nb(Caribou ~ 1 + (1 | location_site), data = mod_dat_wk_cbou)

summary(glmm_wk_cbou_random)

#GLMM with random and survey effort

glmm_wk_cbou_random_eff <- glmer.nb(Caribou ~ 1 +  offset(log(n_days_effort)) + (1 | location_site) , data = mod_dat_wk_cbou)

summary(glmm_wk_cbou_random_eff)
```

Temporal models
```{r}
#GLMM with random, survey effort, snow season
glmm_wk_cbou_snowssn <- glmer.nb(Caribou ~ 1 + snow_season + offset(log(n_days_effort)) + (1 | location_site) , data = mod_dat_wk_cbou)

summary(glmm_wk_cbou_snowssn)

#GLMM with random, survey effort, four season
glmm_wk_cbou_fourssn <- glmer.nb(Caribou ~ 1 + four_season + offset(log(n_days_effort)) + (1 | location_site) , data = mod_dat_wk_cbou)

summary(glmm_wk_cbou_fourssn)

#GLMM with random, survey effort, week.
glmm_wk_cbou_wk <- glmer.nb(Caribou ~ 1 + week + offset(log(n_days_effort)) + (1 | location_site) , data = mod_dat_wk_cbou)

summary(glmm_wk_cbou_wk)
```

### LCC
```{r}
glmm_wk_cbou_lcc <- glmer.nb(Caribou ~ 
                    z.X300_SPPGLM + z.X300_SPPSLM + z.X300_TSPNF + z.X300_SPTNF + z.X300_WET + z.X300_WAT + z.X300_MF + z.X300_TSPS + z.X300_BAR + z.X300_TSPBDF + four_season + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou)


summary(glmm_wk_cbou_lcc)
```

####Tundra LCC
```{r}
glmm_wk_cbou_lcc_tundra <- glmer.nb(Caribou ~ 
                    z.X300_SPPGLM + z.X300_SPPSLM + z.X300_WET + z.X300_WAT + z.X300_BAR + four_season + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou)


summary(glmm_wk_cbou_lcc_tundra)
```

####Treeline Distance
```{r}
glmm_wk_cbou_treeline <- glmer.nb(Caribou ~ 
                    z.treeline_distance_m + four_season + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou)


summary(glmm_wk_cbou_treeline)
```

### DEM

Let's just look at our DEM covariates
```{r}
glmm_wk_cbou_dem <- glmer.nb(Caribou ~ 
                    z.mean_elev_300 + z.mean_tri_300 + z.esker_dist_m + four_season + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou)


summary(glmm_wk_cbou_dem)
```

### Target

```{r}
glmm_wk_cbou_tgt <- glmer.nb(Caribou ~ 
                     target_cons + four_season + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou)


summary(glmm_wk_cbou_tgt)
```


### Co-occurrences

#### Ungulates
```{r}
glmm_wk_cbou_ung <- glmer.nb(Caribou ~ 
                    Muskox + Moose + four_season + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou)


summary(glmm_wk_cbou_ung)
```

#### Predators
```{r}
glmm_wk_cbou_pred <- glmer.nb(Caribou ~ 
                    Gray.Wolf + Grizzly.Bear + Wolverine + four_season + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou)

summary(glmm_wk_cbou_pred)
```


### Significant Only

Let's cut it down to only the significant predictors from the previous models.
```{r}
glmm_wk_cbou_cat2 <- glmer.nb(Caribou ~ 
                    Gray.Wolf + z.X300_SPPGLM + z.X300_SPPSLM + z.X300_WET + z.X300_WAT + z.X300_MF + z.X300_BAR + z.mean_elev_300 + z.esker_dist_m + four_season + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou)


summary(glmm_wk_cbou_cat2)
```

Let's cut it down again....
```{r}
glmm_wk_cbou_cat3 <- glmer.nb(Caribou ~ 
                    Gray.Wolf + z.X300_SPPGLM + z.X300_SPPSLM + z.X300_WET + z.X300_WAT + z.X300_MF + z.X300_BAR + z.esker_dist_m + four_season + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou)

summary(glmm_wk_cbou_cat3)
```

target only model
```{r}
glmm_wk_cbou_tgtonly <- glmer.nb(Caribou ~ 
                     target_cons + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou)

summary(glmm_wk_cbou_tgtonly)
```

#############################################################################################

## DAG Models

Causal diagrams created using diggity to reduce bias and justify models based on hypothesized ecological processes. 

Hashtagged out because it's not season specific

####Bottom Up

```{r}
#glmm_wk_cbou_dag_bu<- glmer.nb(Caribou ~ 
#                              z.X300_SPPGLM + z.X300_SPPSLM + z.X300_BAR + z.X300_WET + z.X300_WAT + z.mean_elev_300 + z.mean_tri_300 + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou)

#summary(glmm_wk_cbou_dag_bu)
```

####Top Down
```{r}
#glmm_wk_cbou_dag_td<- glmer.nb(Caribou ~ 
#                              Gray.Wolf + Grizzly.Bear + z.X300_SPPGLM + z.X300_SPPSLM + z.X300_BAR  + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou)

#summary(glmm_wk_cbou_dag_td)
```

####Apparent Competition

Models the total effect of Muskox and Moose on caribou while adjusting for water, wetland, and DEM covariates. Griz and Wolf didn't require adjustment but this model implies that heterospecific ungulates are acting on caribou through predators.

```{r}
#glmm_wk_cbou_dag_appa<- glmer.nb(Caribou ~ 
#                              Muskox + Moose + z.X300_WET + z.X300_WAT + z.mean_elev_300 + z.mean_tri_300 + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou)

#summary(glmm_wk_cbou_dag_appa)
```

Compare with the model above. If wolf and griz have a strong effect here but ungulates don't have a strong effect above, the effect likely isn't due to apparent competition.
```{r}
#glmm_wk_cbou_dag_appb<- glmer.nb(Caribou ~ 
#                              Gray.Wolf + Grizzly.Bear + z.X300_SPPGLM + z.X300_SPPSLM + z.X300_BAR + z.X300_WET + z.X300_WAT + z.mean_elev_300 + z.mean_tri_300 +offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou)

#summary(glmm_wk_cbou_dag_appb)
```

####DAG Model Selection
```{r}
#model.sel(glmm_wk_cbou_dag_appa, glmm_wk_cbou_dag_appb, glmm_wk_cbou_dag_td, glmm_wk_cbou_dag_bu)
```

#############################################################################################

## Committee Models

Uber simple models that the committee wants run on every data set and in every season

#### Bottom Up

```{r}
glmm_wk_cbou_comm_bu <- glmer.nb(Caribou ~ 
                  z.X300_SPPGLM + z.X300_SPPSLM + z.X300_TSPNF + z.X300_SPTNF + z.X300_WET + z.X300_WAT + z.X300_MF + z.X300_TSPS + z.X300_BAR + z.X300_TSPBDF + z.mean_elev_300 + z.mean_tri_300 + z.esker_dist_m + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou)

summary(glmm_wk_cbou_comm_bu)
```

#### Top Down

```{r}
glmm_wk_cbou_comm_td <- glmer.nb(Caribou ~ 
                  Gray.Wolf + Grizzly.Bear + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou)

summary(glmm_wk_cbou_comm_td)
```

####Apparent Competition

```{r}
glmm_wk_cbou_comm_app <- glmer.nb(Caribou ~ 
                  Muskox + Moose + Gray.Wolf + Grizzly.Bear + Muskox*Gray.Wolf + Muskox*Grizzly.Bear + Moose*Gray.Wolf + Moose*Grizzly.Bear + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou)

summary(glmm_wk_cbou_comm_app)
```

####Committee Model Selection
```{r}
model.sel(glmm_wk_cbou_random_eff, glmm_wk_cbou_fourssn, glmm_wk_cbou_tgtonly, glmm_wk_cbou_comm_bu, glmm_wk_cbou_comm_td, glmm_wk_cbou_comm_app)
```

#############################################################################################

## Model Selection
```{r}
model.sel(glmm_wk_cbou_random, glmm_wk_cbou_random_eff, glmm_wk_cbou_snowssn, glmm_wk_cbou_fourssn, glmm_wk_cbou_wk, glmm_wk_cbou_lcc, glmm_wk_cbou_lcc_tundra, glmm_wk_cbou_dem, glmm_wk_cbou_tgt, glmm_wk_cbou_tgtonly, glmm_wk_cbou_pred, glmm_wk_cbou_ung, glmm_wk_cbou_cat2, glmm_wk_cbou_cat3, glmm_wk_cbou_comm_bu, glmm_wk_cbou_comm_td, glmm_wk_cbou_comm_app, glmm_wk_cbou_treeline)
```


############################################################################################################################################################################################################################
  
# Local, Summer, WEEKLY detection data
```{r}
# Create a new data frame for summer
mod_dat_wk_cbou_summer <- mod_dat_wk_cbou[mod_dat_wk_cbou$four_season == "Summer", ]
```

##Target analysis
```{r}
# Group by target_cons and count unique locations within each group
unique_cbou_locations_by_target_smr <- mod_dat_wk_cbou_summer %>%
  group_by(target_cons) %>%
  summarise(unique_locations = n_distinct(location))

# Print the result
print(unique_cbou_locations_by_target_smr)

#run anova to see if target is important
region_wk_cbou_smr_aov <- aov(Caribou ~ target_cons, data=mod_dat_wk_cbou_summer)
summary(region_wk_cbou_smr_aov)

# Perform Tukey's HSD test to interpret ANOVA
tukey_results <- TukeyHSD(region_wk_cbou_smr_aov)

# View the results
print(tukey_results)
```

##Simple Models
```{r}
#null model
glmm_wk_cbou_smr_null <- glmer.nb(Caribou ~ 
                     offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_summer)
summary(glmm_wk_cbou_smr_null)
```

```{r}
#week model
glmm_wk_cbou_smr_wk <- glmer.nb(Caribou ~ 
                     week + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_summer)
summary(glmm_wk_cbou_smr_wk)
```

## LCC
run LCC model WITHOUT week
```{r}
glmm_wk_cbou_smr_lcc <- glmer.nb(Caribou ~ 
                    z.X300_SPPGLM + z.X300_SPPSLM + z.X300_TSPNF + z.X300_SPTNF + z.X300_WET + z.X300_WAT + z.X300_MF + z.X300_BAR + z.X300_TSPBDF + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_summer)

summary(glmm_wk_cbou_smr_lcc)
```

### Tundra LCC
```{r}
glmm_wk_cbou_smr_lcc_tundra <- glmer.nb(Caribou ~ 
                    z.X300_SPPGLM + z.X300_SPPSLM + z.X300_WET + z.X300_WAT + z.X300_BAR + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_summer)

summary(glmm_wk_cbou_smr_lcc_tundra)
```

###Treeline Distance
```{r}
glmm_wk_cbou_smr_treeline <- glmer.nb(Caribou ~ 
                    z.treeline_distance_m + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_summer)


summary(glmm_wk_cbou_smr_treeline)
```

## DEM

run dem model WITHOUT week
```{r}
glmm_wk_cbou_smr_dem <- glmer.nb(Caribou ~ 
                    z.mean_elev_300 + z.mean_tri_300 + z.esker_dist_m + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_summer)

summary(glmm_wk_cbou_smr_dem)
```


## Target

target WITHOUT week
```{r}
glmm_wk_cbou_smr_other <- glmer.nb(Caribou ~ 
                     target_cons + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_summer)


summary(glmm_wk_cbou_smr_other)
```


## Co-Occurrences

### Ungulates

How do those other ungulates effect caribou habitat use? WITHOUT week
```{r}
glmm_wk_cbou_smr_ung <- glmer.nb(Caribou ~ 
                    Muskox + Moose + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_summer)


summary(glmm_wk_cbou_smr_ung)
```


### Predators

predators, WITHOUT week
```{r}
glmm_wk_cbou_smr_pred <- glmer.nb(Caribou ~ 
                    Gray.Wolf + Grizzly.Bear + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_summer)


summary(glmm_wk_cbou_smr_pred)
```

## Significant Only

SIGNIFICANT ONLY
```{r}
glmm_wk_cbou_smr_sig <- glmer.nb(Caribou ~ 
                    Gray.Wolf + z.X300_SPPGLM + z.X300_SPPSLM + z.X300_WET + z.X300_WAT + z.X300_BAR + z.mean_elev_300 + z.esker_dist_m + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_summer)

summary(glmm_wk_cbou_smr_sig)
```

#############################################################################################

## DAG Models

###Bottom Up
```{r}
glmm_wk_cbou_smr_dag_bu<- glmer.nb(Caribou ~ 
                              z.X300_SPPGLM + z.X300_SPPSLM + z.X300_BAR + z.X300_WAT + z.mean_elev_300 + z.esker_dist_m + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_summer)

summary(glmm_wk_cbou_smr_dag_bu)
```

###Top Down
```{r}
glmm_wk_cbou_smr_dag_td<- glmer.nb(Caribou ~ 
                              Gray.Wolf + Grizzly.Bear + z.X300_SPPGLM + z.X300_SPPSLM + z.X300_BAR + z.X300_WAT + z.esker_dist_m + target_cons + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_summer)

summary(glmm_wk_cbou_smr_dag_td)
```

###Apparent Competition

```{r}
glmm_wk_cbou_smr_dag_appa<- glmer.nb(Caribou ~ 
                              Muskox + Moose + z.X300_SPPGLM + z.X300_SPPSLM + z.X300_WET + z.X300_WAT + z.mean_elev_300 + target_cons + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_summer)

summary(glmm_wk_cbou_smr_dag_appa)
```


```{r}
glmm_wk_cbou_smr_dag_appb<- glmer.nb(Caribou ~ 
                              Gray.Wolf + Grizzly.Bear + z.X300_SPPGLM + z.X300_SPPSLM + z.X300_BAR + z.X300_WAT + z.mean_elev_300 + z.esker_dist_m + target_cons + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_summer)

summary(glmm_wk_cbou_smr_dag_appb)
```

###DAG Model Selection
```{r}
model.sel(glmm_wk_cbou_smr_dag_bu, glmm_wk_cbou_smr_dag_td, glmm_wk_cbou_smr_dag_appa, glmm_wk_cbou_smr_dag_appb)
```
If I'm interpreting this correctly then there may be evidence hinting at apparent competition effects of muskox on caribou in the Summer on the Tundra specifically, with a fairly strong negative effect in App Comp A, but no effect of predators in App Comp B. 

Not sure how to differentiate this from direct effects other than justifying the layout of the DAG using other telemetry studies or dietary studies which support muskox and caribou not directly competing with each other. 

Also seems to be a very strong negative effect of mean TRI. Highest TRI in the tundra sites is likely along Artillery, the Hoarfrost, or the Snowdrift. Selecting for flat tundra areas in the summer.

#############################################################################################

## Committee Models

Uber simple models that the committee wants run on every data set and in every season

#### Bottom Up

```{r}
glmm_wk_cbou_smr_comm_bu <- glmer.nb(Caribou ~ 
                  z.X300_SPPGLM + z.X300_SPPSLM + z.X300_TSPNF + z.X300_SPTNF + z.X300_WET + z.X300_WAT + z.X300_MF + z.X300_BAR + z.X300_TSPBDF + z.mean_elev_300 + z.mean_tri_300 + z.esker_dist_m + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_summer)

summary(glmm_wk_cbou_smr_comm_bu)
```

try new fn based on error checking (google

```{r}
glmm_wk_cbou_smr_comm_bu_2 <- glmmTMB(Caribou ~ 
                  z.X300_SPPGLM + z.X300_SPPSLM + z.X300_TSPNF + z.X300_SPTNF + z.X300_WET + z.X300_WAT + z.X300_MF + z.X300_BAR + z.X300_TSPBDF + z.mean_elev_300 + z.mean_tri_300 + z.esker_dist_m + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_summer, family="nbinom2", control=glmmTMBControl(parallel=5))

summary(glmm_wk_cbou_smr_comm_bu_2)
```
this works much much better...

#### Top Down

```{r}
glmm_wk_cbou_smr_comm_td <- glmer.nb(Caribou ~ 
                  Gray.Wolf + Grizzly.Bear + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_summer)

summary(glmm_wk_cbou_smr_comm_td)
```

####Apparent Competition

```{r}
glmm_wk_cbou_smr_comm_app <- glmer.nb(Caribou ~ 
                  Muskox + Moose + Gray.Wolf + Grizzly.Bear + Muskox*Gray.Wolf + Muskox*Grizzly.Bear + Moose*Gray.Wolf + Moose*Grizzly.Bear + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_summer)

summary(glmm_wk_cbou_smr_comm_app)
```

####Committee Model Selection
```{r}
model.sel(glmm_wk_cbou_smr_null, glmm_wk_cbou_smr_other, glmm_wk_cbou_smr_comm_bu, glmm_wk_cbou_smr_comm_td, glmm_wk_cbou_smr_comm_app)
```

#############################################################################################

## Model Selection
```{r}
model.sel(glmm_wk_cbou_smr_null, glmm_wk_cbou_smr_wk, glmm_wk_cbou_smr_lcc_tundra, glmm_wk_cbou_smr_dem, glmm_wk_cbou_smr_other, glmm_wk_cbou_smr_pred, glmm_wk_cbou_smr_ung, glmm_wk_cbou_smr_sig, glmm_wk_cbou_smr_dag_td, glmm_wk_cbou_smr_dag_bu, glmm_wk_cbou_smr_dag_appa, glmm_wk_cbou_smr_dag_appb, glmm_wk_cbou_smr_comm_bu, glmm_wk_cbou_smr_comm_td, glmm_wk_cbou_smr_comm_app, glmm_wk_cbou_smr_treeline)
```

############################################################################################################################################################################################################################

# Local, Fall, WEEKLY detection data
```{r}
# Create a new data frame for winter
mod_dat_wk_cbou_fall <- mod_dat_wk_cbou[mod_dat_wk_cbou$four_season == "Fall", ]
```

##Target analysis
```{r}
# Group by target_cons and count unique locations within each group
unique_cbou_locations_by_target_fall <- mod_dat_wk_cbou_fall %>%
  group_by(target_cons) %>%
  summarise(unique_locations = n_distinct(location))

# Print the result
print(unique_cbou_locations_by_target_fall)

#run anova to see if target is important
region_wk_cbou_fll_aov <- aov(Caribou ~ target_cons, data=mod_dat_wk_cbou_fall)
summary(region_wk_cbou_fll_aov)

# Perform Tukey's HSD test to interpret ANOVA
tukey_results <- TukeyHSD(region_wk_cbou_fll_aov)

# View the results
print(tukey_results)
```

##Simple Models
```{r}
#null model
glmm_wk_cbou_fall_null <- glmer.nb(Caribou ~ 
                     offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_fall)
summary(glmm_wk_cbou_fall_null)
```

```{r}
#week model
glmm_wk_cbou_fall_wk <- glmer.nb(Caribou ~ 
                     week + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_fall)
summary(glmm_wk_cbou_fall_wk)
```

## LCC
run LCC model WITHOUT week
```{r}
glmm_wk_cbou_fall_lcc <- glmer.nb(Caribou ~ 
                    z.X300_SPPGLM + z.X300_SPPSLM + z.X300_TSPNF + z.X300_SPTNF + z.X300_WET + z.X300_WAT + z.X300_MF + z.X300_TSPS + z.X300_BAR + z.X300_TSPBDF + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_fall)

summary(glmm_wk_cbou_fall_lcc)
```


### Tundra LCC
```{r}
glmm_wk_cbou_fall_lcc_tundra <- glmer.nb(Caribou ~ 
                    z.X300_SPPGLM + z.X300_SPPSLM + z.X300_WET + z.X300_WAT + z.X300_BAR + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_fall)

summary(glmm_wk_cbou_fall_lcc_tundra)
```

###Treeline Distance
```{r}
glmm_wk_cbou_fall_treeline <- glmer.nb(Caribou ~ 
                    z.treeline_distance_m + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_fall)


summary(glmm_wk_cbou_fall_treeline)
```

## DEM

run dem model WITHOUT week
```{r}
glmm_wk_cbou_fall_dem <- glmer.nb(Caribou ~ 
                    z.mean_elev_300 + z.mean_tri_300 + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_fall)

summary(glmm_wk_cbou_fall_dem)
```

## Target

target WITHOUT week
```{r}
glmm_wk_cbou_fall_tgt <- glmer.nb(Caribou ~ 
                     target_cons + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_fall)


summary(glmm_wk_cbou_fall_tgt)
```

## Co-occurrences

### Ungulates

How do those other ungulates effect caribou habitat use? WITHOUT week
```{r}
glmm_wk_cbou_fall_ung <- glmer.nb(Caribou ~ 
                    Muskox + Moose + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_fall)


summary(glmm_wk_cbou_fall_ung)
```

### Predators

predators, WITHOUT week
```{r}
glmm_wk_cbou_fall_pred <- glmer.nb(Caribou ~ 
                    Gray.Wolf + Grizzly.Bear + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_fall)


summary(glmm_wk_cbou_fall_pred)
```

## Significant Only

SIGNIFICANT ONLY
```{r}
glmm_wk_cbou_fall_sig <- glmer.nb(Caribou ~ 
                    Gray.Wolf + z.X300_SPPGLM + z.X300_SPPSLM + z.X300_WET + z.X300_WAT + z.X300_BAR + z.mean_elev_300 + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_fall)

summary(glmm_wk_cbou_fall_sig)
```

#############################################################################################

## DAG Models
```{r}
#glmm_wk_cbou_fall_dag<- glmer.nb(Caribou ~ 
                              #Moose + Muskox + Gray.Wolf + Grizzly.Bear + z.X300_SPPGLM + z.X300_SPPSLM + z.X300_WET + z.X300_WAT + z.X300_BAR + z.mean_elev_300 + z.mean_tri_300 + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_fall)

#summary(glmm_wk_cbou_fall_dag)
```

#############################################################################################

## Committee Models

Uber simple models that the committee wants run on every data set and in every season

#### Bottom Up

```{r}
glmm_wk_cbou_fll_comm_bu <- glmer.nb(Caribou ~ 
                  z.X300_SPPGLM + z.X300_SPPSLM + z.X300_TSPNF + z.X300_SPTNF + z.X300_WET + z.X300_WAT + z.X300_MF + z.X300_TSPS + z.X300_BAR + z.X300_TSPBDF + z.mean_elev_300 + z.mean_tri_300 + z.esker_dist_m + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_fall)

summary(glmm_wk_cbou_fll_comm_bu)
```

#### Top Down

```{r}
glmm_wk_cbou_fll_comm_td <- glmer.nb(Caribou ~ 
                  Gray.Wolf + Grizzly.Bear + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_fall)

summary(glmm_wk_cbou_fll_comm_td)
```

####Apparent Competition

```{r}
glmm_wk_cbou_fll_comm_app <- glmer.nb(Caribou ~ 
                  Muskox + Moose + Gray.Wolf + Grizzly.Bear + Muskox*Gray.Wolf + Muskox*Grizzly.Bear + Moose*Gray.Wolf + Moose*Grizzly.Bear + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_fall)

summary(glmm_wk_cbou_fll_comm_app)
```

####Committee Model Selection
```{r}
model.sel(glmm_wk_cbou_fall_null, glmm_wk_cbou_fall_tgt, glmm_wk_cbou_fll_comm_bu, glmm_wk_cbou_fll_comm_td, glmm_wk_cbou_fll_comm_app)
```


#############################################################################################

## Model Selection
```{r}
model.sel(glmm_wk_cbou_fall_null, glmm_wk_cbou_fall_wk, glmm_wk_cbou_fall_lcc, glmm_wk_cbou_fall_lcc_tundra, glmm_wk_cbou_fall_dem, glmm_wk_cbou_fall_tgt, glmm_wk_cbou_fall_pred, glmm_wk_cbou_fall_ung, glmm_wk_cbou_fall_sig, glmm_wk_cbou_fll_comm_bu, glmm_wk_cbou_fll_comm_td, glmm_wk_cbou_fll_comm_app, glmm_wk_cbou_fall_treeline)
```


################################################################################################################################################################################################################################################

# Local, Winter, WEEKLY detection data
```{r}
# Create a new data frame for winter
mod_dat_wk_cbou_winter <- mod_dat_wk_cbou[mod_dat_wk_cbou$four_season == "Winter", ]
```

##Target analysis
```{r}
# Group by target_cons and count unique locations within each group
unique_cbou_locations_by_target_wtr <- mod_dat_wk_cbou_winter %>%
  group_by(target_cons) %>%
  summarise(unique_locations = n_distinct(location))

# Print the result
print(unique_cbou_locations_by_target_wtr)

#run anova to see if target is important
region_wk_cbou_wtr_aov <- aov(Caribou ~ target_cons, data=mod_dat_wk_cbou_winter)
summary(region_wk_cbou_wtr_aov)

# Perform Tukey's HSD test to interpret ANOVA
tukey_results <- TukeyHSD(region_wk_cbou_wtr_aov)

# View the results
print(tukey_results)
```

##Simple Models
```{r}
#null model
glmm_wk_cbou_wtr_null <- glmer.nb(Caribou ~ 
                     offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_winter)
summary(glmm_wk_cbou_wtr_null)
```

```{r}
#week model
glmm_wk_cbou_wtr_wk <- glmer.nb(Caribou ~ 
                     week + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_winter)
summary(glmm_wk_cbou_wtr_wk)
```

## LCC
run LCC model WITHOUT week
```{r}
glmm_wk_cbou_wtr_lcc <- glmer.nb(Caribou ~ 
                    z.X300_SPPGLM + z.X300_SPPSLM + z.X300_TSPNF + z.X300_SPTNF + z.X300_WET + z.X300_WAT + z.X300_MF + z.X300_TSPS + z.X300_BAR + z.X300_TSPBDF + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_winter)

summary(glmm_wk_cbou_wtr_lcc)
```


### Tundra LCC
```{r}
glmm_wk_cbou_wtr_lcc_tundra <- glmer.nb(Caribou ~ 
                    z.X300_SPPGLM + z.X300_SPPSLM + z.X300_WET + z.X300_WAT + z.X300_BAR + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_winter)

summary(glmm_wk_cbou_wtr_lcc_tundra)
```

###Treeline Distance
```{r}
glmm_wk_cbou_wtr_treeline <- glmer.nb(Caribou ~ 
                    z.treeline_distance_m + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_winter)


summary(glmm_wk_cbou_wtr_treeline)
```

## DEM

run dem model WITHOUT week
```{r}
glmm_wk_cbou_wtr_dem <- glmer.nb(Caribou ~ 
                    z.mean_elev_300 + z.mean_tri_300 + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_winter)

summary(glmm_wk_cbou_wtr_dem)
```


## Target

target WITHOUT week
```{r}
glmm_wk_cbou_wtr_other <- glmer.nb(Caribou ~ 
                     target_cons + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_winter)


summary(glmm_wk_cbou_wtr_other)
```


## Co-occurrences

### Ungulates

How do those other ungulates effect caribou habitat use? WITHOUT week
```{r}
glmm_wk_cbou_wtr_ung <- glmer.nb(Caribou ~ 
                    Muskox + Moose + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_winter)


summary(glmm_wk_cbou_wtr_ung)
```


### Predators

predators, WITHOUT week
```{r}
glmm_wk_cbou_wtr_pred <- glmer.nb(Caribou ~ 
                    Gray.Wolf + Grizzly.Bear + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_winter)


summary(glmm_wk_cbou_wtr_pred)
```

## Significant Only

SIGNIFICANT ONLY
```{r}
glmm_wk_cbou_wtr_sig <- glmer.nb(Caribou ~ 
                    Gray.Wolf + z.X300_SPPGLM + z.X300_SPPSLM + z.X300_WET + z.X300_WAT + z.X300_BAR + z.mean_elev_300 + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_winter)

summary(glmm_wk_cbou_wtr_sig)
```

wout elevation which stopped showing as signif
```{r}
glmm_wk_cbou_wtr_sig2 <- glmer.nb(Caribou ~ 
                    Gray.Wolf + z.X300_SPPGLM + z.X300_SPPSLM + z.X300_WET + z.X300_WAT + z.X300_BAR + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_winter)

summary(glmm_wk_cbou_wtr_sig2)
```

#############################################################################################

## DAG Models
```{r}
#glmm_wk_cbou_wtr_dag<- glmer.nb(Caribou ~ 
                              #Moose + Muskox + Gray.Wolf + Grizzly.Bear + z.X300_SPPGLM + z.X300_SPPSLM + z.X300_WET + z.X300_WAT + z.X300_BAR + z.mean_elev_300 + z.mean_tri_300 + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_winter)

#summary(glmm_wk_cbou_wtr_dag)
```

#############################################################################################

## Committee Models

Uber simple models that the committee wants run on every data set and in every season

#### Bottom Up

```{r}
glmm_wk_cbou_wtr_comm_bu <- glmer.nb(Caribou ~ 
                  z.X300_SPPGLM + z.X300_SPPSLM + z.X300_TSPNF + z.X300_SPTNF + z.X300_WET + z.X300_WAT + z.X300_MF + z.X300_TSPS + z.X300_BAR + z.X300_TSPBDF + z.mean_elev_300 + z.mean_tri_300 + z.esker_dist_m + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_winter)

summary(glmm_wk_cbou_wtr_comm_bu)
```

#### Top Down

```{r}
glmm_wk_cbou_wtr_comm_td <- glmer.nb(Caribou ~ 
                  Gray.Wolf + Grizzly.Bear + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_winter)

summary(glmm_wk_cbou_wtr_comm_td)
```

####Apparent Competition

```{r}
glmm_wk_cbou_wtr_comm_app <- glmer.nb(Caribou ~ 
                  Muskox + Moose + Gray.Wolf + Grizzly.Bear + Muskox*Gray.Wolf + Muskox*Grizzly.Bear + Moose*Gray.Wolf + Moose*Grizzly.Bear + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_winter)

summary(glmm_wk_cbou_wtr_comm_app)
```

####Committee Model Selection
```{r}
model.sel(glmm_wk_cbou_wtr_null, glmm_wk_cbou_wtr_other, glmm_wk_cbou_wtr_comm_bu, glmm_wk_cbou_wtr_comm_td, glmm_wk_cbou_wtr_comm_app)
```

#############################################################################################

## Model Selection
```{r}
model.sel(glmm_wk_cbou_wtr_null, glmm_wk_cbou_wtr_wk, glmm_wk_cbou_wtr_lcc, glmm_wk_cbou_wtr_lcc_tundra, glmm_wk_cbou_wtr_dem, glmm_wk_cbou_wtr_other, glmm_wk_cbou_wtr_pred, glmm_wk_cbou_wtr_ung, glmm_wk_cbou_wtr_sig, glmm_wk_cbou_wtr_sig2, glmm_wk_cbou_wtr_comm_bu, glmm_wk_cbou_wtr_comm_td, glmm_wk_cbou_wtr_comm_app, glmm_wk_cbou_wtr_treeline)
```


############################################################################################################################################################################################################################

# Local, Spring, WEEKLY detection data
```{r}
# Create a new data frame for winter
mod_dat_wk_cbou_spri <- mod_dat_wk_cbou[mod_dat_wk_cbou$four_season == "Spring", ]
```

##Target analysis
```{r}
# Group by target_cons and count unique locations within each group
unique_cbou_locations_by_target_spr <- mod_dat_wk_cbou_spri %>%
  group_by(target_cons) %>%
  summarise(unique_locations = n_distinct(location))

# Print the result
print(unique_cbou_locations_by_target_spr)

#run anova to see if target is important
region_wk_cbou_spr_aov <- aov(Caribou ~ target_cons, data=mod_dat_wk_cbou_spri)
summary(region_wk_cbou_spr_aov)

# Perform Tukey's HSD test to interpret ANOVA
tukey_results <- TukeyHSD(region_wk_cbou_spr_aov)

# View the results
print(tukey_results)
```

##Simple Models
```{r}
#null model
glmm_wk_cbou_spri_null <- glmer.nb(Caribou ~ 
                     offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_spri)
summary(glmm_wk_cbou_spri_null)
```

```{r}
#week model
glmm_wk_cbou_spri_wk <- glmer.nb(Caribou ~ 
                     week + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_spri)
summary(glmm_wk_cbou_spri_wk)
```

## LCC
run LCC model WITHOUT week
```{r}
glmm_wk_cbou_spri_lcc <- glmer.nb(Caribou ~ 
                    z.X300_SPPGLM + z.X300_SPPSLM + z.X300_TSPNF + z.X300_SPTNF + z.X300_WET + z.X300_WAT + z.X300_MF + z.X300_TSPS + z.X300_BAR + z.X300_TSPBDF + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_spri)

summary(glmm_wk_cbou_spri_lcc)
```


### Tundra LCC
```{r}
glmm_wk_cbou_spri_lcc_tundra <- glmer.nb(Caribou ~ 
                    z.X300_SPPGLM + z.X300_SPPSLM + z.X300_WET + z.X300_WAT + z.X300_BAR + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_spri)

summary(glmm_wk_cbou_fall_lcc_tundra)
```

###Treeline Distance
```{r}
glmm_wk_cbou_spri_treeline <- glmer.nb(Caribou ~ 
                    z.treeline_distance_m + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_spri)


summary(glmm_wk_cbou_spri_treeline)
```

## DEM

run dem model WITHOUT week
```{r}
glmm_wk_cbou_spri_dem <- glmer.nb(Caribou ~ 
                    z.mean_elev_300 + z.mean_tri_300 + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_spri)

summary(glmm_wk_cbou_spri_dem)
```


## Target

target WITHOUT week
```{r}
glmm_wk_cbou_spri_tgt <- glmer.nb(Caribou ~ 
                     target_cons + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_spri)


summary(glmm_wk_cbou_spri_tgt)
```



## Co-occurrences

### Ungulates

How do those other ungulates effect caribou habitat use? WITHOUT week
```{r}
glmm_wk_cbou_spri_ung <- glmer.nb(Caribou ~ 
                    Muskox + Moose + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_spri)


summary(glmm_wk_cbou_spri_ung)
```



### Predators

predators, WITHOUT week
```{r}
glmm_wk_cbou_spri_pred <- glmer.nb(Caribou ~ 
                    Gray.Wolf + Grizzly.Bear + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_spri)


summary(glmm_wk_cbou_spri_pred)
```

## Significant Only

SIGNIFICANT ONLY
```{r}
glmm_wk_cbou_spri_sig <- glmer.nb(Caribou ~ 
                    Gray.Wolf + z.X300_SPPGLM + z.X300_SPPSLM + z.X300_WET + z.X300_WAT + z.X300_BAR + z.mean_elev_300 + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_spri)

summary(glmm_wk_cbou_spri_sig)
```


add MF and remove wolf and elev???
```{r}
glmm_wk_cbou_spri_sig2 <- glmer.nb(Caribou ~ 
                    z.X300_SPPGLM + z.X300_SPPSLM + z.X300_WET + z.X300_WAT + z.X300_BAR + z.X300_MF + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_spri)

summary(glmm_wk_cbou_spri_sig2)
```

#############################################################################################

## DAG Models
```{r}
#glmm_wk_cbou_spri_dag<- glmer.nb(Caribou ~ 
#                              Moose + Muskox + Gray.Wolf + Grizzly.Bear + z.X300_SPPGLM + z.X300_SPPSLM + z.X300_WET + z.X300_WAT + z.X300_BAR + z.mean_elev_300 + z.mean_tri_300 + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_spri)

#summary(glmm_wk_cbou_spri_dag)
```

#############################################################################################

## Committee Models

Uber simple models that the committee wants run on every data set and in every season

#### Bottom Up

```{r}
glmm_wk_cbou_spr_comm_bu <- glmer.nb(Caribou ~ 
                  z.X300_SPPGLM + z.X300_SPPSLM + z.X300_TSPNF + z.X300_SPTNF + z.X300_WET + z.X300_WAT + z.X300_MF + z.X300_TSPS + z.X300_BAR + z.X300_TSPBDF + z.mean_elev_300 + z.mean_tri_300 + z.esker_dist_m + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_spri)

summary(glmm_wk_cbou_spr_comm_bu)
```

#### Top Down

```{r}
glmm_wk_cbou_spr_comm_td <- glmer.nb(Caribou ~ 
                  Gray.Wolf + Grizzly.Bear + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_spri)

summary(glmm_wk_cbou_spr_comm_td)
```

####Apparent Competition

```{r}
glmm_wk_cbou_spr_comm_app <- glmer.nb(Caribou ~ 
                  Muskox + Moose + Gray.Wolf + Grizzly.Bear + Muskox*Gray.Wolf + Muskox*Grizzly.Bear + Moose*Gray.Wolf + Moose*Grizzly.Bear + offset(log(n_days_effort)) + (1|location_site) , data=mod_dat_wk_cbou_spri)

summary(glmm_wk_cbou_spr_comm_app)
```

####Committee Model Selection
```{r}
model.sel(glmm_wk_cbou_spri_null, glmm_wk_cbou_spri_tgt, glmm_wk_cbou_spr_comm_bu, glmm_wk_cbou_spr_comm_td, glmm_wk_cbou_spr_comm_app)
```


#############################################################################################

## Model Selection
```{r}
model.sel(glmm_wk_cbou_spri_null, glmm_wk_cbou_spri_wk, glmm_wk_cbou_spri_lcc, glmm_wk_cbou_spri_lcc_tundra, glmm_wk_cbou_spri_dem, glmm_wk_cbou_spri_tgt, glmm_wk_cbou_spri_pred, glmm_wk_cbou_spri_ung, glmm_wk_cbou_spri_sig, glmm_wk_cbou_spri_sig2, glmm_wk_cbou_spr_comm_bu, glmm_wk_cbou_spr_comm_td, glmm_wk_cbou_spr_comm_app, glmm_wk_cbou_spri_treeline)
```

#NOTE: 2024-02-25 ###########################################################################
Removed multispecies models because the committee didn't want to go down this route...
